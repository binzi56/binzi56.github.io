<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>火の玉</title>
  <subtitle>Just an iOS learner</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://binzi56.github.io/"/>
  <updated>2018-08-21T13:05:05.408Z</updated>
  <id>https://binzi56.github.io/</id>
  
  <author>
    <name>火の玉</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Xcode添加子工程及其环境配置</title>
    <link href="https://binzi56.github.io/2018/03/25/iOS-create-subProject/"/>
    <id>https://binzi56.github.io/2018/03/25/iOS-create-subProject/</id>
    <published>2018-03-25T08:57:51.000Z</published>
    <updated>2018-08-21T13:05:05.408Z</updated>
    
    <content type="html"><![CDATA[<p>最近项目收到一个新需求，需要添加子工程分解项目一部分功能，👇将学到的一些东西分享下；<br>示例：<br><strong>主工程（AddSubProjectDemo）</strong><br><strong>子工程（subProject）</strong></p>
<a id="more"></a>
<h5 id="1-创建主工程（AddSubProjectDemo）以及子工程（subProject）"><a href="#1-创建主工程（AddSubProjectDemo）以及子工程（subProject）" class="headerlink" title="1. 创建主工程（AddSubProjectDemo）以及子工程（subProject）"></a>1. 创建主工程（AddSubProjectDemo）以及子工程（subProject）</h5><p>这里注意一下子工程创建的时候是<code>Cocoa Static Library</code>；<br><img src="https://upload-images.jianshu.io/upload_images/1893416-f08eeb84f4afcd77.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="子工程创建示例图"><br>两个工程创建完毕如图：<br><img src="https://upload-images.jianshu.io/upload_images/1893416-92bb75b82d22ca60.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h5 id="2-添加子工程及其依赖"><a href="#2-添加子工程及其依赖" class="headerlink" title="2.添加子工程及其依赖"></a>2.添加子工程及其依赖</h5><h6 id="2-1-子工程拖进主工程文件目录中："><a href="#2-1-子工程拖进主工程文件目录中：" class="headerlink" title="2.1 子工程拖进主工程文件目录中："></a>2.1 子工程拖进主工程文件目录中：</h6><p><img src="https://upload-images.jianshu.io/upload_images/1893416-171dd213a7b49ac8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h6 id="2-2-打开主工程添加子工程"><a href="#2-2-打开主工程添加子工程" class="headerlink" title="2.2 打开主工程添加子工程"></a>2.2 打开主工程添加子工程</h6><p>这里可以选择Drag或Add File to “AddSubProjectDemo”,结束后如图：<br><img src="https://upload-images.jianshu.io/upload_images/1893416-6b027e77b4aa1c80.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h6 id="2-3-在主工程中添加子工程依赖（-a文件）"><a href="#2-3-在主工程中添加子工程依赖（-a文件）" class="headerlink" title="2.3 在主工程中添加子工程依赖（.a文件）"></a>2.3 在主工程中添加子工程依赖（.a文件）</h6><p>在工程<code>target -&gt; Build Phases -&gt; Link Binary With Libraries</code>中添加<code>libsubProject.a</code><br><img src="https://upload-images.jianshu.io/upload_images/1893416-5746395f0e7daa00.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h6 id="2-4-在主工程中添加子工程头文件"><a href="#2-4-在主工程中添加子工程头文件" class="headerlink" title="2.4 在主工程中添加子工程头文件"></a>2.4 在主工程中添加子工程头文件</h6><p>在工程<code>target -&gt; Build Settings -&gt; Search Paths -&gt; Header Search Paths</code>中加入子文件目录；<br><img src="https://upload-images.jianshu.io/upload_images/1893416-63f2ac7d48b54fb7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>关于<code>Header Search Paths</code>这里说明一下：</p>
<ol>
<li><code>$(inherited)</code><br>target在设置自己路径的时候如果加了这个，那么就是继承project里设置的路径。如果不需要继承就不加，要不然乱加有可能整混导致路径错误。</li>
<li>带引号的路径和不带引号的路径<br>带引号主要是预防路径里有空格导致本来一个路径变成了两个路径，因为空格分开就被解析位两个路径，所以最好路径带上引号。</li>
<li><code>$(SRCROOT) / $(PROJECT_DIR)</code>基本没啥区别，都是指向<code>*.xcodeproj</code>所在的路径</li>
<li><code>recursive</code>遍历该目录，<code>non-recursive</code>默认路径设置；不遍历该目录。</li>
</ol>
</blockquote>
<p>工程环境配置好后，本例在子工程加了一个类方法打印，主工程回调，最终效果如下：<br><img src="https://upload-images.jianshu.io/upload_images/1893416-bc5eddf194b72e94.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>附上demo工程：<br><a href="https://github.com/binzi56/AddSubProjectDemo.git" target="_blank" rel="external">demo下载</a></p>
<p>参考文章：<br><a href="https://www.jianshu.com/p/f2bc7d155a86" target="_blank" rel="external">Xcode创建子工程以及工程依赖</a><br><a href="https://www.jianshu.com/p/9f9c1fd2e8b5" target="_blank" rel="external">Xcode Search Paths相关配置</a><br><a href="https://blog.csdn.net/ylwdi/article/details/26259207" target="_blank" rel="external">Xcode环境设置</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;最近项目收到一个新需求，需要添加子工程分解项目一部分功能，👇将学到的一些东西分享下；&lt;br&gt;示例：&lt;br&gt;&lt;strong&gt;主工程（AddSubProjectDemo）&lt;/strong&gt;&lt;br&gt;&lt;strong&gt;子工程（subProject）&lt;/strong&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="iOS" scheme="https://binzi56.github.io/categories/iOS/"/>
    
    
      <category term="iOS" scheme="https://binzi56.github.io/tags/iOS/"/>
    
      <category term="objective-c" scheme="https://binzi56.github.io/tags/objective-c/"/>
    
      <category term="Xcode" scheme="https://binzi56.github.io/tags/Xcode/"/>
    
  </entry>
  
  <entry>
    <title>iOS制作电子签章</title>
    <link href="https://binzi56.github.io/2017/12/16/iOS-electronic-signature/"/>
    <id>https://binzi56.github.io/2017/12/16/iOS-electronic-signature/</id>
    <published>2017-12-16T08:57:51.000Z</published>
    <updated>2017-12-20T12:24:13.946Z</updated>
    
    <content type="html"><![CDATA[<p>吃晚饭的时候, 朋友发了一组图片过来, 让我抠个图; 对, 没听错, 知道我是程序猿, 所以让我抠个图;<br><img src="http://upload-images.jianshu.io/upload_images/1893416-468ef184ce3e1947.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>抠图这个说法, UI设计师们都接受不了; 身为程序猿当然要更高雅一些, 能敲代码的就绝不抠图;<br><img src="http://upload-images.jianshu.io/upload_images/1893416-84dede82b6ccab5a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<a id="more"></a>
<p>好了, 进入正题; 其实分析一下, 需求也比较简单, 就是把图片中的白色或者接近白色的背景换为透明, 黑色签名露出来; 下面是图片处理前:<br><img src="http://upload-images.jianshu.io/upload_images/1893416-207a3d2599590cea.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>首先说一下返回原始图片文字, 代码如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">//返回原始图像(将图片的背景置为透明)</div><div class="line">- (UIImage *)returnOrginImage:(UIImage *)sourceImage</div><div class="line">&#123;</div><div class="line">    //分配内存</div><div class="line">    const int imageWidth = sourceImage.size.width;</div><div class="line">    const int imageHeight = sourceImage.size.height;</div><div class="line">    size_t bytesPerRow = imageWidth * 4;</div><div class="line">    uint32_t* rgbImageBuf = (uint32_t*)malloc(bytesPerRow * imageHeight);</div><div class="line"></div><div class="line">    //创建context</div><div class="line">    CGColorSpaceRef colorSpace = CGColorSpaceCreateDeviceRGB();</div><div class="line">    CGContextRef context = CGBitmapContextCreate(rgbImageBuf, imageWidth, imageHeight, 8, bytesPerRow, colorSpace,kCGBitmapByteOrder32Little | kCGImageAlphaNoneSkipLast);</div><div class="line">    CGContextDrawImage(context, CGRectMake(0, 0, imageWidth, imageHeight), sourceImage.CGImage);</div><div class="line"></div><div class="line">    //遍历像素</div><div class="line">    int pixelNum = imageWidth * imageHeight;</div><div class="line">    uint32_t* pCurPtr = rgbImageBuf;</div><div class="line">    for (int i = 0; i &lt; pixelNum; i++, pCurPtr++)&#123;</div><div class="line">        //接近白色</div><div class="line">        //将像素点转成子节数组来表示---RGBA</div><div class="line">        //ptr[0]:透明度,ptr[1]:R,ptr[2]:G,ptr[3]:B</div><div class="line"></div><div class="line">        //分别取出RGB值后。进行判断需不需要设成透明</div><div class="line">        uint8_t* ptr = (uint8_t*)pCurPtr;</div><div class="line">        if (ptr[1] &gt; 140 &amp;&amp; ptr[2] &gt; 140 &amp;&amp; ptr[3] &gt; 140) &#123;</div><div class="line">            //当RGB值都大于140则比较接近白色的都将透明度设为0</div><div class="line">            //demo中的图片有点灰, 所以设置了140, 可以根据需要自行设置</div><div class="line">            ptr[0] = 0;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    //将内存转成image</div><div class="line">    CGDataProviderRef dataProvider =CGDataProviderCreateWithData(NULL, rgbImageBuf, bytesPerRow * imageHeight, nil);</div><div class="line">    CGImageRef imageRef = CGImageCreate(imageWidth, imageHeight,8, 32, bytesPerRow, colorSpace,kCGImageAlphaLast |kCGBitmapByteOrder32Little, dataProvider,NULL, true,kCGRenderingIntentDefault);</div><div class="line">    CGDataProviderRelease(dataProvider);</div><div class="line"></div><div class="line">    UIImage *resultUIImage = [UIImage imageWithCGImage:imageRef];</div><div class="line"></div><div class="line">    //释放</div><div class="line">    CGImageRelease(imageRef);</div><div class="line">    CGContextRelease(context);</div><div class="line">    CGColorSpaceRelease(colorSpace);</div><div class="line">    return resultUIImage;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>参数bytesPerRow代表被渲染内存区域中每行所占字节, 其中4代表每个像素点RGBA所占的字节, 之后乘以<code>imageHeight</code>得到所占内存空间;<code>colorspace</code>用于被渲染内存区域的颜色;最关键的代码就是将RGB值为白色或趋近与白色的透明度设为0;我这里取了140是因为这张图片背景有点灰, 大家可以自行设置;<br>效果如下:<br><img src="http://upload-images.jianshu.io/upload_images/1893416-b66dea0ad03274d6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="原图图像"></p>
<p>看得出文字有点模糊, 这是因为处理过程是对每一个像素直接设置为透明,  图片并不是只有黑白两个颜色, 所以文字周边的区域就会变暗了, 再加上原图给的也不是很清晰, 那应该怎么处理呢?<br>这里涉及到灰度图, 代码如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">//返回灰度图像</div><div class="line">-(UIImage*)returnGrayImage:(UIImage*)sourceImage&#123;</div><div class="line">    int width = sourceImage.size.width;</div><div class="line">    int height = sourceImage.size.height;</div><div class="line"></div><div class="line">    CGColorSpaceRef colorSpace = CGColorSpaceCreateDeviceGray();</div><div class="line">    CGContextRef context = CGBitmapContextCreate (nil,width,height,8,0,colorSpace,kCGImageAlphaNone);</div><div class="line">    CGColorSpaceRelease(colorSpace);</div><div class="line"></div><div class="line">    if (context == NULL) &#123;</div><div class="line">        return nil;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    CGContextDrawImage(context,CGRectMake(0, 0, width, height), sourceImage.CGImage);</div><div class="line">    UIImage *grayImage = [UIImage imageWithCGImage:CGBitmapContextCreateImage(context)];</div><div class="line">    CGContextRelease(context);</div><div class="line"></div><div class="line">    return grayImage;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>效果图:<br><img src="http://upload-images.jianshu.io/upload_images/1893416-9d562934957373b1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="灰度图"></p>
<p>说到灰度图, 就不得不提一个很著名的彩色转灰度的心理学公式：<br><code>Gray = R*0.299 + G*0.587 + B*0.114</code></p>
<blockquote>
<p>算法处理如下:<br>a.      首先将彩色图像转换为灰度图像<br>b.      计算灰度图像的算术平均值M<br>c.      以M为阈值，完成对灰度图二值化( 大于阈值M,像素点赋值为白色，否则赋值为黑<br>色)</p>
</blockquote>
<p>上面的代码还看不出来, 应该是方法内部做了处理, 咱们来看👇下面的:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">for (size_t i = 0; i &lt; height; i++) &#123;</div><div class="line">       for (size_t j = 0; j &lt; width; j++)&#123;</div><div class="line">           // 设置每个像素的rgba值</div><div class="line">           size_t pixelIndex = i * width * 4 + j * 4;</div><div class="line">           unsigned char red   = data[pixelIndex];</div><div class="line">           unsigned char green = data[pixelIndex + 1];</div><div class="line">           unsigned char blue  = data[pixelIndex + 2];</div><div class="line"></div><div class="line">           //取灰度值</div><div class="line">           unsigned char gray = 0.299 * red + 0.587 * green + 0.114 * blue;</div><div class="line">           data[pixelIndex]     = gray;    // r</div><div class="line">           data[pixelIndex + 1] = gray;    // g</div><div class="line">           data[pixelIndex + 2] = gray;    // b</div><div class="line">       &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>附:<br><a href="http://en.wikipedia.org/wiki/Grayscale#Converting_color_to_grayscale" target="_blank" rel="external">维基灰度算法</a></p>
<p>处理成灰度图后基本只剩下黑白两种颜色; 为了寻求最优解, 我们再把屏幕中白色变透明, 黑色加深, 就得到所谓的高保真效果了;<br>代码如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">//返回高保真图像(只返回黑白两种颜色)</div><div class="line">- (UIImage *)returnHightQualityImage:(UIImage *)sourceImage&#123;</div><div class="line">    NSData *imageData = UIImagePNGRepresentation(sourceImage);</div><div class="line"></div><div class="line">    CGImageSourceRef sourceRef = CGImageSourceCreateWithData((CFDataRef)imageData, NULL);</div><div class="line">    CGImageRef imageRef = CGImageSourceCreateImageAtIndex(sourceRef, 0, NULL);</div><div class="line"></div><div class="line">    size_t width = CGImageGetWidth(imageRef);</div><div class="line">    size_t height = CGImageGetHeight(imageRef);</div><div class="line"></div><div class="line">    unsigned char *data = calloc(width * height * 4, sizeof(unsigned char)); // 取图片首地址</div><div class="line">    size_t bitsPerComponent = 8; // r g b a 每个component bits数目</div><div class="line">    size_t bytesPerRow = width * 4; // 一张图片每行字节数目 (每个像素点包含r g b a 四个字节)</div><div class="line">    CGColorSpaceRef space = CGColorSpaceCreateDeviceRGB(); // 创建rgb颜色空间</div><div class="line"></div><div class="line">    CGContextRef context = CGBitmapContextCreate(data, width, height, bitsPerComponent, bytesPerRow, space, kCGImageAlphaPremultipliedLast | kCGBitmapByteOrder32Big);</div><div class="line">    CGContextDrawImage(context, CGRectMake(0, 0, width, height), imageRef);</div><div class="line"></div><div class="line">    for (size_t i = 0; i &lt; height; i++)</div><div class="line">    &#123;</div><div class="line">        for (size_t j = 0; j &lt; width; j++)</div><div class="line">        &#123;</div><div class="line">            // 设置每个像素的rgba值</div><div class="line">            size_t pixelIndex = i * width * 4 + j * 4;</div><div class="line"></div><div class="line">            unsigned char red   = data[pixelIndex];</div><div class="line">            unsigned char green = data[pixelIndex + 1];</div><div class="line">            unsigned char blue  = data[pixelIndex + 2];</div><div class="line"></div><div class="line">            //取灰度值</div><div class="line">            unsigned char gray = 0.299 * red + 0.587 * green + 0.114 * blue;</div><div class="line">            gray = gray &gt; 150 ? 255 : 0;</div><div class="line">            data[pixelIndex]     = gray;    // r</div><div class="line">            data[pixelIndex + 1] = gray;    // g</div><div class="line">            data[pixelIndex + 2] = gray;    // b</div><div class="line">            data[pixelIndex + 3] = gray == 255 ? 0 : 255;    // a (255 代表透明)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    CGImageRef newImage = CGBitmapContextCreateImage(context);</div><div class="line">    UIImage *image = [[UIImage alloc] initWithCGImage:newImage];</div><div class="line">    return image;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>最终效果图:<br><img src="http://upload-images.jianshu.io/upload_images/1893416-2ed17a648b9b1d31.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="高保真"></p>
<p>最后附上github地址;<br><a href="https://github.com/binzi56/ChangeBgColorDemo" target="_blank" rel="external">demo下载</a></p>
<blockquote>
<p><strong>扩展</strong><br><a href="https://zhuanlan.zhihu.com/p/30745861" target="_blank" rel="external">用 C 语言画光–Milo Yip</a><br><img src="http://upload-images.jianshu.io/upload_images/1893416-fa2327db028f4a1e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="效果图"></p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;吃晚饭的时候, 朋友发了一组图片过来, 让我抠个图; 对, 没听错, 知道我是程序猿, 所以让我抠个图;&lt;br&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1893416-468ef184ce3e1947.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;抠图这个说法, UI设计师们都接受不了; 身为程序猿当然要更高雅一些, 能敲代码的就绝不抠图;&lt;br&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1893416-84dede82b6ccab5a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="iOS" scheme="https://binzi56.github.io/categories/iOS/"/>
    
    
      <category term="iOS" scheme="https://binzi56.github.io/tags/iOS/"/>
    
      <category term="objective-c" scheme="https://binzi56.github.io/tags/objective-c/"/>
    
  </entry>
  
  <entry>
    <title>源码剖析--SVPullToRefresh</title>
    <link href="https://binzi56.github.io/2017/10/17/iOS-SVPullToRefresh/"/>
    <id>https://binzi56.github.io/2017/10/17/iOS-SVPullToRefresh/</id>
    <published>2017-10-16T16:29:17.000Z</published>
    <updated>2017-10-16T16:38:39.000Z</updated>
    
    <content type="html"><![CDATA[<p>阅读源码之路终于开启了, 小白一枚, 大神们要多多照顾啊, 有什么建议可以评论或私信, 在此多谢了!!!!</p>
<hr>
<h2 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h2><p><img src="http://upload-images.jianshu.io/upload_images/1893416-e1f3d71f45bb56e7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="文件结构"></p>
<h5 id="文章目录"><a href="#文章目录" class="headerlink" title="文章目录"></a>文章目录</h5><ul>
<li>前言</li>
<li>API说明</li>
<li>原理解析</li>
<li>总结</li>
</ul>
<hr>
<h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1.前言"></a>1.前言</h2><p>作为一个刷新框架, <a href="https://github.com/samvermette/SVPullToRefresh" target="_blank" rel="external">SVPullToRefresh</a>以其简洁, 通俗易懂为大家所推崇. 对于刚开始读源码的我来说, 再合适不过了, 而且最近正在做一个刷新demo, 用到, 顺便整理一下, 学习学习.<br>SV是个熟悉的前缀, 就算没听过<a href="https://github.com/samvermette/SVPullToRefresh" target="_blank" rel="external">SVPullToRefresh</a>, 也听过<a href="https://github.com/samvermette/SVProgressHUD" target="_blank" rel="external">SVProgressHUD</a>吧. 除了这些, 作者<a href="http://samvermette.com" target="_blank" rel="external">Sam</a>还有其他优秀的开源代码, 大家感兴趣可以看看.</p>
<hr>
<a id="more"></a>
<h2 id="2-API说明"><a href="#2-API说明" class="headerlink" title="2.API说明"></a>2.API说明</h2><h4 id="2-1-下拉刷新"><a href="#2-1-下拉刷新" class="headerlink" title="2.1 下拉刷新"></a>2.1 下拉刷新</h4><p><strong>下拉刷新ScrollView</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">@class SVPullToRefreshView;</div><div class="line">@interface UIScrollView (SVPullToRefresh)</div><div class="line"></div><div class="line">typedef NS_ENUM(NSUInteger, SVPullToRefreshPosition) &#123;</div><div class="line">    SVPullToRefreshPositionTop = 0,</div><div class="line">    SVPullToRefreshPositionBottom,</div><div class="line">&#125;;</div><div class="line"></div><div class="line">//默认添加方法, position为top</div><div class="line">- (void)addPullToRefreshWithActionHandler:(void (^)(void))actionHandler;</div><div class="line"></div><div class="line">/*</div><div class="line">  自定义添加下拉刷新的方法, 可以改变刷新方式;</div><div class="line">  top为下拉刷新, bottom为上拉刷新;</div><div class="line">*/</div><div class="line">- (void)addPullToRefreshWithActionHandler:(void (^)(void))actionHandler position:(SVPullToRefreshPosition)position;</div><div class="line"></div><div class="line">//触发一次刷新, 会执行handler这个block里面的方法</div><div class="line">- (void)triggerPullToRefresh;</div><div class="line"></div><div class="line">//下拉刷新视图</div><div class="line">@property (nonatomic, strong, readonly) SVPullToRefreshView *pullToRefreshView;</div><div class="line"></div><div class="line">//是否展示下拉刷新视图(须在addPullToRefreshWithActionHandler:方法后面)</div><div class="line">@property (nonatomic, assign) BOOL showsPullToRefresh;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure></p>
<p><strong>下拉刷新View</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">//只保留可更改选项</div><div class="line"></div><div class="line">@interface SVPullToRefreshView : UIView</div><div class="line">//下拉刷新箭头颜色</div><div class="line">@property (nonatomic, strong) UIColor *arrowColor;</div><div class="line">//文本颜色</div><div class="line">@property (nonatomic, strong) UIColor *textColor;</div><div class="line">//指示器view颜色</div><div class="line">@property (nonatomic, strong, readwrite) UIColor *activityIndicatorViewColor NS_AVAILABLE_IOS(5_0);</div><div class="line">//指示器类型</div><div class="line">@property (nonatomic, readwrite) UIActivityIndicatorViewStyle activityIndicatorViewStyle;</div><div class="line"></div><div class="line">//根据刷新状态设置标题</div><div class="line">- (void)setTitle:(NSString *)title forState:(SVPullToRefreshState)state;</div><div class="line">//根据刷新状态设置副标题</div><div class="line">- (void)setSubtitle:(NSString *)subtitle forState:(SVPullToRefreshState)state;</div><div class="line">//根据刷新状态设置自定义View</div><div class="line">- (void)setCustomView:(UIView *)view forState:(SVPullToRefreshState)state;</div><div class="line"></div><div class="line">//开始动画</div><div class="line">- (void)startAnimating;</div><div class="line">//结束动画</div><div class="line">- (void)stopAnimating;</div><div class="line"></div><div class="line">//最后更新日期(NSDate)</div><div class="line">@property (nonatomic, strong) NSDate *lastUpdatedDate DEPRECATED_ATTRIBUTE;</div><div class="line">//日期格式(NSDateFormatter)</div><div class="line">@property (nonatomic, strong) NSDateFormatter *dateFormatter DEPRECATED_ATTRIBUTE;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure></p>
<p>👇是我自己测试的, 把所有属性玩了一遍, 亲测好用, O(∩_∩)O哈哈~<br><img src="http://upload-images.jianshu.io/upload_images/1893416-fa4677ef411c6391.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="下拉测试效果图"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"> [self.tableView addPullToRefreshWithActionHandler:^&#123;</div><div class="line">       //下拉刷新数据</div><div class="line">    &#125;];</div><div class="line">    self.tableView.pullToRefreshView.backgroundColor = RedColor;</div><div class="line">    self.tableView.pullToRefreshView.arrowColor = [UIColor whiteColor];</div><div class="line">    self.tableView.pullToRefreshView.textColor = [UIColor whiteColor];</div><div class="line">    [self.tableView.pullToRefreshView setSubtitle:@&quot;火之玉&quot; forState:SVInfiniteScrollingStateLoading];</div><div class="line">    [self.tableView.pullToRefreshView setTitle:@&quot;正在加载..waiting..&quot; forState:SVInfiniteScrollingStateLoading];</div><div class="line"></div><div class="line">    self.tableView.pullToRefreshView.activityIndicatorViewColor = BlueColor;</div><div class="line">    self.tableView.pullToRefreshView.activityIndicatorViewStyle = UIActivityIndicatorViewStyleWhiteLarge;</div><div class="line"></div><div class="line">//    UIView *pullView = [[UIView alloc] initWithFrame:CGRectMake(0, 0, 50, 50)];</div><div class="line">//    pullView.backgroundColor = [UIColor cyanColor];</div><div class="line">//    [self.tableView.pullToRefreshView setCustomView:pullView forState:SVPullToRefreshStateAll];</div></pre></td></tr></table></figure>
<h4 id="2-2-上拉刷新"><a href="#2-2-上拉刷新" class="headerlink" title="2.2 上拉刷新"></a>2.2 上拉刷新</h4><p><strong>上拉刷新ScrollView</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">@class SVInfiniteScrollingView;</div><div class="line"></div><div class="line">@interface UIScrollView (SVInfiniteScrolling)</div><div class="line">//默认添加上拉刷新视图</div><div class="line">- (void)addInfiniteScrollingWithActionHandler:(void (^)(void))actionHandler;</div><div class="line">////触发一次刷新, 会执行handler这个block里面的方法</div><div class="line">- (void)triggerInfiniteScrolling;</div><div class="line">//上拉刷新视图</div><div class="line">@property (nonatomic, strong, readonly) SVInfiniteScrollingView *infiniteScrollingView;</div><div class="line">//是否展示上拉刷新视图</div><div class="line">@property (nonatomic, assign) BOOL showsInfiniteScrolling;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure></p>
<p><strong>上拉刷新View</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">@interface SVInfiniteScrollingView : UIView</div><div class="line">//指示器类型</div><div class="line">@property (nonatomic, readwrite) UIActivityIndicatorViewStyle activityIndicatorViewStyle;</div><div class="line">//刷新状态</div><div class="line">@property (nonatomic, readonly) SVInfiniteScrollingState state;</div><div class="line">//是否取消上拉加载</div><div class="line">@property (nonatomic, readwrite) BOOL enabled;</div><div class="line">//根据刷新状态设置自定义View</div><div class="line">- (void)setCustomView:(UIView *)view forState:(SVInfiniteScrollingState)state;</div><div class="line">//开始动画</div><div class="line">- (void)startAnimating;</div><div class="line">//结束动画</div><div class="line">- (void)stopAnimating;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure></p>
<p>附上测试效果:<br><img src="http://upload-images.jianshu.io/upload_images/1893416-623ae6f8c963101b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="上拉测试效果图"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">    // setup infinite scrolling</div><div class="line">    [self.tableView addInfiniteScrollingWithActionHandler:^&#123;</div><div class="line">        //上拉刷新数据</div><div class="line">    &#125;];</div><div class="line"></div><div class="line">    self.tableView.infiniteScrollingView.backgroundColor = BlueColor;</div><div class="line">    self.tableView.infiniteScrollingView.activityIndicatorViewStyle = UIActivityIndicatorViewStyleWhite;</div><div class="line"></div><div class="line">//    UIImageView *pullImageView = [[UIImageView alloc] initWithFrame:CGRectMake(0, 0, 50, 50)];</div><div class="line">//    pullImageView.image = [UIImage imageNamed:@&quot;avatar&quot;];</div><div class="line">//    pullImageView.layer.cornerRadius = 25;</div><div class="line">//    pullImageView.layer.masksToBounds = YES;</div><div class="line">//    [self.tableView.infiniteScrollingView setCustomView:pullImageView forState:SVPullToRefreshStateAll];</div><div class="line">//</div><div class="line">//    self.tableView.infiniteScrollingView.enabled = NO;</div></pre></td></tr></table></figure>
<h2 id="3-原理解析"><a href="#3-原理解析" class="headerlink" title="3.原理解析"></a>3.原理解析</h2><h4 id="3-1-下拉刷新"><a href="#3-1-下拉刷新" class="headerlink" title="3.1 下拉刷新"></a>3.1 下拉刷新</h4><p><img src="http://upload-images.jianshu.io/upload_images/1893416-eb7e0de8a37132ee.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="下拉刷新流程图"></p>
<p>以上是下拉刷新的主要流程图, 接下来我们就来扣扣细节;</p>
<h6 id="3-1-1-void-triggerPullToRefresh触发了一次刷新"><a href="#3-1-1-void-triggerPullToRefresh触发了一次刷新" class="headerlink" title="3.1.1 -(void)triggerPullToRefresh触发了一次刷新:"></a>3.1.1 <code>-(void)triggerPullToRefresh</code>触发了一次刷新:</h6><p>以下是方法的内部实现;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">- (void)triggerPullToRefresh &#123;</div><div class="line">    self.pullToRefreshView.state = SVPullToRefreshStateTriggered;</div><div class="line">    [self.pullToRefreshView startAnimating];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>看了一眼, 当时就懵了; 怎么就这点儿代码, 完全看不出来啊, 别着急, 接着一个个点进去看. 发现state属性的setter方法里面做了处理;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">- (void)setState:(SVPullToRefreshState)newState &#123;</div><div class="line"></div><div class="line">    if(_state == newState)</div><div class="line">        return;</div><div class="line"></div><div class="line">    SVPullToRefreshState previousState = _state;</div><div class="line">    _state = newState;</div><div class="line"></div><div class="line">    [self setNeedsLayout];</div><div class="line">    [self layoutIfNeeded];</div><div class="line"></div><div class="line">    switch (newState) &#123;</div><div class="line">        case SVPullToRefreshStateAll:</div><div class="line">        case SVPullToRefreshStateStopped:</div><div class="line">            [self resetScrollViewContentInset];</div><div class="line">            break;</div><div class="line"></div><div class="line">        case SVPullToRefreshStateTriggered:</div><div class="line">            break;</div><div class="line"></div><div class="line">        case SVPullToRefreshStateLoading:</div><div class="line">            [self setScrollViewContentInsetForLoading];</div><div class="line"></div><div class="line">            if(previousState == SVPullToRefreshStateTriggered &amp;&amp; pullToRefreshActionHandler)</div><div class="line">                pullToRefreshActionHandler();</div><div class="line">            break;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>接下来拆分一下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">self.pullToRefreshView.state = SVPullToRefreshStateTriggered;</div></pre></td></tr></table></figure></p>
<p>执行完这步代码, 执行一次<code>-(void)setState:</code>, 之后break跳出;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[self.pullToRefreshView startAnimating];</div></pre></td></tr></table></figure></p>
<p>这步<code>pullToRefreshView</code>执行<code>-(void)startAnimating</code>, 方法内部实现如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">- (void)startAnimating&#123;</div><div class="line">    ...</div><div class="line">    self.state = SVPullToRefreshStateLoading;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>可以看出之后又执行了一次<code>-(void)setState:</code>, 这时<code>previousState == SVPullToRefreshStateTriggered</code>条件满足, 执行infiniteScrollingHandler(), 也就执行了block里面刷新数据的方法;</p>
<h6 id="3-1-2-利用runtime-KVO添加成员变量"><a href="#3-1-2-利用runtime-KVO添加成员变量" class="headerlink" title="3.1.2 利用runtime+KVO添加成员变量"></a>3.1.2 利用runtime+KVO添加成员变量</h6><p>代码如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">static char UIScrollViewPullToRefreshView;</div><div class="line">- (void)setPullToRefreshView:(SVPullToRefreshView *)pullToRefreshView &#123;</div><div class="line">    [self willChangeValueForKey:@&quot;SVPullToRefreshView&quot;];</div><div class="line">    objc_setAssociatedObject(self, &amp;UIScrollViewPullToRefreshView,</div><div class="line">                             pullToRefreshView,</div><div class="line">                             OBJC_ASSOCIATION_ASSIGN);</div><div class="line">    [self didChangeValueForKey:@&quot;SVPullToRefreshView&quot;];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (SVPullToRefreshView *)pullToRefreshView &#123;</div><div class="line">    return objc_getAssociatedObject(self, &amp;UIScrollViewPullToRefreshView);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>关于KVO:</strong><br>从代码中可以看出<code>willChangeValueForKey :</code>和<code>didChangeValueForKey :</code>是KVO的一部分, 源文件的代码为:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">@interface NSObject(NSKeyValueObserverNotification)</div><div class="line">- (void)willChangeValueForKey:(NSString *)key;</div><div class="line">- (void)didChangeValueForKey:(NSString *)key;</div><div class="line">@end</div></pre></td></tr></table></figure></p>
<p>用了这两个方法也就代表手动触发了KVO, 这也为了控制回调的调用时机, 在<code>setPullToRefreshView:</code>中触发. 而手动触发的场景一般是不使用属性，或重写了setter，需要手动通知系统.<br>一般我们是不需要用的, 比如<code>@property</code>写一个属性, 系统会以某种方式在中间插入 <code>wilChangeValueForKey:</code>, <code>didChangeValueForKey:</code>和 <code>observeValueForKeyPath:ofObject:change:context:</code>的调用.<br>想要了解更多, 可以看一下<br><a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/KeyValueObserving/Articles/KVOCompliance.html#//apple_ref/doc/uid/20002178-SW3" target="_blank" rel="external">KVO Programming Guide - Apple官方文档</a></p>
<p><strong>关于runtime:</strong><br>这里要知道这两个方法:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">//set</div><div class="line">objc_setAssociatedObject(id _Nonnull object, const void * _Nonnull key,</div><div class="line">                         id _Nullable value, objc_AssociationPolicy policy)</div><div class="line">//get</div><div class="line">objc_getAssociatedObject(id _Nonnull object, const void * _Nonnull key)</div><div class="line"></div><div class="line">//objc_AssociationPolicy类型说明</div><div class="line">//关联时采用的协议，有assign，retain，copy等协议，一般使用OBJC_ASSOCIATION_RETAIN_NONATOMIC</div><div class="line">typedef OBJC_ENUM(uintptr_t, objc_AssociationPolicy) &#123;</div><div class="line">    OBJC_ASSOCIATION_ASSIGN = 0,           /**&lt; Specifies a weak reference to the associated object. */</div><div class="line">    OBJC_ASSOCIATION_RETAIN_NONATOMIC = 1, /**&lt; Specifies a strong reference to the associated object.</div><div class="line">                                            *   The association is not made atomically. */</div><div class="line">    OBJC_ASSOCIATION_COPY_NONATOMIC = 3,   /**&lt; Specifies that the associated object is copied.</div><div class="line">                                            *   The association is not made atomically. */</div><div class="line">    OBJC_ASSOCIATION_RETAIN = 01401,       /**&lt; Specifies a strong reference to the associated object.</div><div class="line">                                            *   The association is made atomically. */</div><div class="line">    OBJC_ASSOCIATION_COPY = 01403          /**&lt; Specifies that the associated object is copied.</div><div class="line">                                            *   The association is made atomically. */</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>看完所有API, 其实也了解的差不多, 这样就给scrollView增加了一个<code>SVPullToRefreshView</code>类型的属性;</p>
<h6 id="3-1-3-监听探究"><a href="#3-1-3-监听探究" class="headerlink" title="3.1.3 监听探究"></a>3.1.3 监听探究</h6><p>这里主要涉及scrollView的三个监听, <code>contentOffset</code>, <code>contentSize</code>, <code>frame</code>;<br><code>frame</code>就不用说了, 说一下另外两个;<br><code>contentOffset</code>是scrollview当前显示区域顶点相对于frame顶点的偏移量。可以理解为contentview的顶点相对于scrollerVIew的frame的偏移量;<br><code>contentSize</code>是scrollview当前所有内容区域的大小;<br>顺便提下<code>contentInset</code>, 下面用到, 表示contentView.frame与scrollerView.frame的关系, 可以类比于css里的padding.<br>例如:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">testScrollView.contentInset = UIEdgeInsetsMake(10, 10, 10, 10);</div></pre></td></tr></table></figure></p>
<p>则testScrollView的top, left, bottom, right为10;</p>
<p>好了, 现在到重头戏了, 监听如何执行的, 代码如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">#pragma mark - Observing</div><div class="line">- (void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary *)change context:(void *)context &#123;</div><div class="line">    if([keyPath isEqualToString:@&quot;contentOffset&quot;])</div><div class="line">        [self scrollViewDidScroll:[[change valueForKey:NSKeyValueChangeNewKey] CGPointValue]];</div><div class="line">    else if([keyPath isEqualToString:@&quot;contentSize&quot;]) &#123;</div><div class="line">        [self layoutSubviews];</div><div class="line">        CGFloat yOrigin;</div><div class="line">        ...</div><div class="line">        self.frame = CGRectMake(0, yOrigin, self.bounds.size.width, SVPullToRefreshViewHeight);</div><div class="line">    &#125;</div><div class="line">    else if([keyPath isEqualToString:@&quot;frame&quot;])</div><div class="line">        [self layoutSubviews];</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>可以理解为当监听<code>contentOffset</code>改变时, scrollView滚动, 此时执行<code>scrollViewDidScroll:</code>方法得到此时的滚动state; 当为<code>contentSize</code>和<code>frame</code>时, scrollView视图发生变化, 此时执行<code>layoutSubviews</code>重新加载视图, 包括根据状态改变视图样式, 都在这里面执行;<br><strong><code>scrollViewDidScroll:</code>方法:</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">- (void)scrollViewDidScroll:(CGPoint)contentOffset &#123;</div><div class="line">    if(self.state != SVPullToRefreshStateLoading) &#123;</div><div class="line">        CGFloat scrollOffsetThreshold = 0;</div><div class="line">        switch (self.position) &#123;</div><div class="line">            case SVPullToRefreshPositionTop:</div><div class="line">                scrollOffsetThreshold = self.frame.origin.y - self.originalTopInset;</div><div class="line">                break;</div><div class="line">            case SVPullToRefreshPositionBottom:</div><div class="line">                scrollOffsetThreshold = MAX(self.scrollView.contentSize.height - self.scrollView.bounds.size.height, 0.0f) + self.bounds.size.height + self.originalBottomInset;</div><div class="line">                break;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        if(!self.scrollView.isDragging &amp;&amp; self.state == SVPullToRefreshStateTriggered)</div><div class="line">            self.state = SVPullToRefreshStateLoading;</div><div class="line">        else if(contentOffset.y &lt; scrollOffsetThreshold &amp;&amp; self.scrollView.isDragging &amp;&amp; self.state == SVPullToRefreshStateStopped &amp;&amp; self.position == SVPullToRefreshPositionTop)</div><div class="line">            self.state = SVPullToRefreshStateTriggered;</div><div class="line">        else if(contentOffset.y &gt;= scrollOffsetThreshold &amp;&amp; self.state != SVPullToRefreshStateStopped &amp;&amp; self.position == SVPullToRefreshPositionTop)</div><div class="line">            self.state = SVPullToRefreshStateStopped;</div><div class="line">        else if(contentOffset.y &gt; scrollOffsetThreshold &amp;&amp; self.scrollView.isDragging &amp;&amp; self.state == SVPullToRefreshStateStopped &amp;&amp; self.position == SVPullToRefreshPositionBottom)</div><div class="line">            self.state = SVPullToRefreshStateTriggered;</div><div class="line">        else if(contentOffset.y &lt;= scrollOffsetThreshold &amp;&amp; self.state != SVPullToRefreshStateStopped &amp;&amp; self.position == SVPullToRefreshPositionBottom)</div><div class="line">            self.state = SVPullToRefreshStateStopped;</div><div class="line">    &#125; else &#123;</div><div class="line">        CGFloat offset;</div><div class="line">        UIEdgeInsets contentInset;</div><div class="line">        switch (self.position) &#123;</div><div class="line">            case SVPullToRefreshPositionTop:</div><div class="line">                ...</div><div class="line">                self.scrollView.contentInset = UIEdgeInsetsMake(offset, contentInset.left, contentInset.bottom, contentInset.right);</div><div class="line">                break;</div><div class="line">            case SVPullToRefreshPositionBottom:</div><div class="line">                if (self.scrollView.contentSize.height &gt;= self.scrollView.bounds.size.height) &#123;</div><div class="line">                    ...</div><div class="line">                    self.scrollView.contentInset = UIEdgeInsetsMake(contentInset.top, contentInset.left, offset, contentInset.right);</div><div class="line">                &#125; else if (self.wasTriggeredByUser) &#123;</div><div class="line">                    ...</div><div class="line">                    self.scrollView.contentInset = UIEdgeInsetsMake(-offset, contentInset.left, contentInset.bottom, contentInset.right);</div><div class="line">                &#125;</div><div class="line">                break;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>可以看出根据postion位置, state是SVPullToRefreshStateLoading状态的时候, 改变scrollView的contentInset;非该状态的时候, 根据contentOffset和postion设置state;<br><img src="http://upload-images.jianshu.io/upload_images/1893416-aded6f779f3e39d4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>下拉刷新后, scrollView的内容高度下移60; 当然只是内容高度, 整个scrollView还是全屏的, 对比css中padding理解一下;<br>注:<br> <code>SVPullToRefreshView</code>向右移动一点儿距离, 方便看视图层级;</p>
<p><strong><code>layoutSubviews</code>方法:</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line">- (void)layoutSubviews &#123;</div><div class="line"></div><div class="line">    for(id otherView in self.viewForState) &#123;</div><div class="line">        if([otherView isKindOfClass:[UIView class]])</div><div class="line">           //从父视图剥离</div><div class="line">            [otherView removeFromSuperview];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    id customView = [self.viewForState objectAtIndex:self.state];</div><div class="line">    BOOL hasCustomView = [customView isKindOfClass:[UIView class]];</div><div class="line"></div><div class="line">    self.titleLabel.hidden = hasCustomView;</div><div class="line">    self.subtitleLabel.hidden = hasCustomView;</div><div class="line">    self.arrow.hidden = hasCustomView;</div><div class="line"></div><div class="line">    if(hasCustomView) &#123;</div><div class="line">      //添加customView</div><div class="line">        [self addSubview:customView];</div><div class="line">        ...</div><div class="line">        [customView setFrame:CGRectMake(origin.x, origin.y, viewBounds.size.width, viewBounds.size.height)];</div><div class="line">    &#125;</div><div class="line">    else &#123;</div><div class="line">   //根据state旋转arrowView</div><div class="line">        switch (self.state) &#123;</div><div class="line">            case SVPullToRefreshStateAll:</div><div class="line">            case SVPullToRefreshStateStopped:</div><div class="line">                self.arrow.alpha = 1;</div><div class="line">                [self.activityIndicatorView stopAnimating];</div><div class="line">                switch (self.position) &#123;</div><div class="line">                    case SVPullToRefreshPositionTop:</div><div class="line">                        [self rotateArrow:0 hide:NO];</div><div class="line">                        break;</div><div class="line">                    case SVPullToRefreshPositionBottom:</div><div class="line">                        [self rotateArrow:(float)M_PI hide:NO];</div><div class="line">                        break;</div><div class="line">                &#125;</div><div class="line">                break;</div><div class="line"></div><div class="line">            ...</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        CGFloat leftViewWidth = MAX(self.arrow.bounds.size.width,self.activityIndicatorView.bounds.size.width);</div><div class="line"></div><div class="line">        ...</div><div class="line">        CGFloat labelX = (self.bounds.size.width / 2) - (totalMaxWidth / 2) + leftViewWidth + margin;</div><div class="line"></div><div class="line">        if(subtitleSize.height &gt; 0)&#123;</div><div class="line">            ...</div><div class="line">            self.titleLabel.frame = CGRectIntegral(CGRectMake(labelX, titleY, titleSize.width, titleSize.height));</div><div class="line">            self.subtitleLabel.frame = CGRectIntegral(CGRectMake(labelX, titleY + titleSize.height + marginY, subtitleSize.width, subtitleSize.height));</div><div class="line">        &#125;else&#123;</div><div class="line">            ...</div><div class="line">            self.titleLabel.frame = CGRectIntegral(CGRectMake(labelX, titleY, titleSize.width, titleSize.height));</div><div class="line">            self.subtitleLabel.frame = CGRectIntegral(CGRectMake(labelX, titleY + titleSize.height + marginY, subtitleSize.width, subtitleSize.height));</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        CGFloat arrowX = (self.bounds.size.width / 2) - (totalMaxWidth / 2) + (leftViewWidth - self.arrow.bounds.size.width) / 2;</div><div class="line">        self.arrow.frame = CGRectMake(arrowX,</div><div class="line">                                      (self.bounds.size.height / 2) - (self.arrow.bounds.size.height / 2),</div><div class="line">                                      self.arrow.bounds.size.width,</div><div class="line">                                      self.arrow.bounds.size.height);</div><div class="line">        self.activityIndicatorView.center = self.arrow.center;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><code>self.viewForState</code>为一个可变数组, 里面是而且根据状态装入相应state的customView, 首先从通过<code>- (void)setCustomView:forState:</code>方法添加后<code>removeFromSuperview</code>从父视图剥离, 之后根据是否传入了customView决定是否添加自定义视图; 如果没有customView则改变里面arrowView的角度;最后都得改变<code>titleLabel</code>, <code>subtitleLabel</code>, <code>arrow</code>, <code>activityIndicatorView</code>的尺寸或位置;<br>值得注意的是里面的一个方法暴露了demo的年纪, O(∩_∩)O哈哈~<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (CGSize)sizeWithFont:(UIFont *)font constrainedToSize:(CGSize)size lineBreakMode:(NSLineBreakMode)lineBreakMode NS_DEPRECATED_IOS(2_0, 7_0, &quot;Use -boundingRectWithSize:options:attributes:context:&quot;) __TVOS_PROHIBITED;</div></pre></td></tr></table></figure></p>
<p>7.0之后已取消, 难怪我感觉没见过这个方法. 哎, 还是太年轻<del>~</del></p>
<h4 id="3-2-上拉刷新"><a href="#3-2-上拉刷新" class="headerlink" title="3.2 上拉刷新"></a>3.2 上拉刷新</h4><p>话不多说, 先看东西…(此话出自老罗语录😊)<br><img src="http://upload-images.jianshu.io/upload_images/1893416-489dd2f370ac3295.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="上拉刷新流程图"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">- (void)setState:(SVInfiniteScrollingState)newState &#123;</div><div class="line"></div><div class="line">    if(_state == newState)</div><div class="line">        return;</div><div class="line"></div><div class="line">    SVInfiniteScrollingState previousState = _state;</div><div class="line">    _state = newState;</div><div class="line"></div><div class="line">    for(id otherView in self.viewForState) &#123;</div><div class="line">        if([otherView isKindOfClass:[UIView class]])</div><div class="line">            [otherView removeFromSuperview];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    id customView = [self.viewForState objectAtIndex:newState];</div><div class="line">    BOOL hasCustomView = [customView isKindOfClass:[UIView class]];</div><div class="line"></div><div class="line">    if(hasCustomView) &#123;</div><div class="line">        [self addSubview:customView];</div><div class="line">        ...</div><div class="line">        [customView setFrame:CGRectMake(origin.x, origin.y, viewBounds.size.width, viewBounds.size.height)];</div><div class="line">    &#125;</div><div class="line">    else &#123;</div><div class="line">        ...</div><div class="line">        [self.activityIndicatorView setFrame:CGRectMake(origin.x, origin.y, viewBounds.size.width, viewBounds.size.height)];</div><div class="line">        //根据状态设置activityIndicatorView是否动画</div><div class="line">        switch (newState) &#123;</div><div class="line">            case SVInfiniteScrollingStateStopped:</div><div class="line">                [self.activityIndicatorView stopAnimating];</div><div class="line">                break;</div><div class="line">            ...</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    if(previousState == SVInfiniteScrollingStateTriggered &amp;&amp; newState == SVInfiniteScrollingStateLoading &amp;&amp; self.infiniteScrollingHandler &amp;&amp; self.enabled)</div><div class="line">        self.infiniteScrollingHandler();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>上拉刷新相对于下拉, 少了很多东西, 也就简单了一些, 重复性的就不多说了.值得注意的是, 对比下拉, 上拉把<code>layoutSubviews</code>里面东西放到<code>setState:</code>里面. 也是, 毕竟没多少东西, 对比着下拉刷新来看;</p>
<h2 id="4-总结"><a href="#4-总结" class="headerlink" title="4.总结"></a>4.总结</h2><p>这次阅读源码，可以说收获满满啊。以前觉得源码阅读是个比较枯燥的过程，可是当我把一个个问题解决了之后，成就感也慢慢累积，感觉就是越读越来劲儿。而且发现读一遍是远远不够的，每看了一遍都多少会有些收获。慢慢的从(这个方法是干什么的)–&gt;(为什么写这个方法)–&gt;(为什么写在这里)，等等一些思考。在对作者称赞👍的同时也为自己认识了这种方法而感到高兴。<br>再接再厉！！！<br>加油💪2017！！！</p>
<blockquote>
<p>想要了解更多的内容, 可以关注一下我的个人公众号。该公众号每个工作日会有新闻推送，每周技术分享，博客更新会实时推送。做个有态度的iOS开发者，就从身边的一件件小事儿做起。满满的正能量，有没有？Do you get it？<br><img src="http://upload-images.jianshu.io/upload_images/1893416-dbd322b5baeea686.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;阅读源码之路终于开启了, 小白一枚, 大神们要多多照顾啊, 有什么建议可以评论或私信, 在此多谢了!!!!&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&quot;概要&quot;&gt;&lt;a href=&quot;#概要&quot; class=&quot;headerlink&quot; title=&quot;概要&quot;&gt;&lt;/a&gt;概要&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1893416-e1f3d71f45bb56e7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;文件结构&quot;&gt;&lt;/p&gt;
&lt;h5 id=&quot;文章目录&quot;&gt;&lt;a href=&quot;#文章目录&quot; class=&quot;headerlink&quot; title=&quot;文章目录&quot;&gt;&lt;/a&gt;文章目录&lt;/h5&gt;&lt;ul&gt;
&lt;li&gt;前言&lt;/li&gt;
&lt;li&gt;API说明&lt;/li&gt;
&lt;li&gt;原理解析&lt;/li&gt;
&lt;li&gt;总结&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&quot;1-前言&quot;&gt;&lt;a href=&quot;#1-前言&quot; class=&quot;headerlink&quot; title=&quot;1.前言&quot;&gt;&lt;/a&gt;1.前言&lt;/h2&gt;&lt;p&gt;作为一个刷新框架, &lt;a href=&quot;https://github.com/samvermette/SVPullToRefresh&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;SVPullToRefresh&lt;/a&gt;以其简洁, 通俗易懂为大家所推崇. 对于刚开始读源码的我来说, 再合适不过了, 而且最近正在做一个刷新demo, 用到, 顺便整理一下, 学习学习.&lt;br&gt;SV是个熟悉的前缀, 就算没听过&lt;a href=&quot;https://github.com/samvermette/SVPullToRefresh&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;SVPullToRefresh&lt;/a&gt;, 也听过&lt;a href=&quot;https://github.com/samvermette/SVProgressHUD&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;SVProgressHUD&lt;/a&gt;吧. 除了这些, 作者&lt;a href=&quot;http://samvermette.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Sam&lt;/a&gt;还有其他优秀的开源代码, 大家感兴趣可以看看.&lt;/p&gt;
&lt;hr&gt;
    
    </summary>
    
      <category term="iOS" scheme="https://binzi56.github.io/categories/iOS/"/>
    
    
      <category term="iOS" scheme="https://binzi56.github.io/tags/iOS/"/>
    
      <category term="源码剖析" scheme="https://binzi56.github.io/tags/%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>iOS11问题汇总</title>
    <link href="https://binzi56.github.io/2017/10/03/iOS11-problems/"/>
    <id>https://binzi56.github.io/2017/10/03/iOS11-problems/</id>
    <published>2017-10-03T10:48:03.000Z</published>
    <updated>2017-10-15T05:04:28.000Z</updated>
    
    <content type="html"><![CDATA[<p>iOS11最终还是来了, 这次改版屏幕尺寸, 控件特性都有一些比较大的改变. 网上看的问题零零散散, 👇收集了一下开发中出现的问题, 整理一下, 方便之后使用.</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1893416-a195c2b81590dd7f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="目录概览"><br><a id="more"></a></p>
<h3 id="1-导航栏"><a href="#1-导航栏" class="headerlink" title="1. 导航栏"></a>1. 导航栏</h3><blockquote>
<p>导航栏高度一直是固定的64P, 到了iOS11这个规则被打破了, 除了iPhoneX全面屏, 刘海等适配问题, 还增加了大标题的属性, <code>titleView</code>支持<code>autolayout</code>;<br><img src="http://upload-images.jianshu.io/upload_images/1893416-daac4a32e952f600.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="大标题示例" title="大标题示例"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; //根据prefersLargeTitles设置, 默认为NO;</div><div class="line">&gt;  self.navigationController.navigationBar.prefersLargeTitles = YES;</div><div class="line">&gt;</div></pre></td></tr></table></figure></p>
<p>下方附一个导航栏的对比图:<br><img src="http://upload-images.jianshu.io/upload_images/1893416-91dd5506e292db2c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="一般机型导航栏尺寸图(除了iPhoneX)" title="一般机型导航栏尺寸图(除了iPhoneX)"><br><img src="http://upload-images.jianshu.io/upload_images/1893416-ae10d86857447eb1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="iPhoneX导航栏尺寸图" title="iPhoneX导航栏尺寸图"></p>
</blockquote>
<h5 id="1-1-尺寸适配"><a href="#1-1-尺寸适配" class="headerlink" title="1.1 尺寸适配"></a>1.1 尺寸适配</h5><p><strong>sol 1: 宏定义高度</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">#define NAVIGATION_HEIGHT (CGRectGetHeight([[UIApplication sharedApplication] statusBarFrame]) + CGRectGetHeight(self.navigationController.navigationBar.frame))</div><div class="line"></div><div class="line">#ifdef __IPHONE_11_0</div><div class="line">if (@available(iOS 11.0, *)) &#123;</div><div class="line">self.navigationBar.frame = CGRectMake(0, STATUSBAR_HEIGHT,ScreenWidth, NAVIGATION_HEIGHT);</div><div class="line">&#125;</div><div class="line">#endif</div></pre></td></tr></table></figure></p>
<p><strong>sol 2: 工具类获取高度</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">@implementation TestUtil</div><div class="line">+ (CGFloat)navigationBarHeight &#123;</div><div class="line">    if (IS_iPhoneX) &#123;</div><div class="line">        return 88.0f;</div><div class="line">    &#125;</div><div class="line">    return 64.0f;</div><div class="line">&#125;</div><div class="line">@end</div><div class="line">#define IS_iPhoneX ([UIScreen mainScreen].bounds.size.width == 375 &amp;&amp; [UIScreen mainScreen].bounds.size.height == 812)</div></pre></td></tr></table></figure></p>
<h5 id="1-2-titleView扩展"><a href="#1-2-titleView扩展" class="headerlink" title="1.2 titleView扩展"></a>1.2 titleView扩展</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//titleView自扩展尺寸, 需要自定义view实现该方法</div><div class="line">- (CGSize)intrinsicContentSize &#123;</div><div class="line">    return UILayoutFittingExpandedSize;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="1-3-返回按钮偏移"><a href="#1-3-返回按钮偏移" class="headerlink" title="1.3 返回按钮偏移"></a>1.3 返回按钮偏移</h5><p>返回按钮向下偏移;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//设置navigationController的backIndicatorImage和backIndicatorTransitionMaskImage</div><div class="line">UIImage *backButtonImage = [[UIImage imageNamed:@&quot;icon_tabbar_back&quot;] imageWithRenderingMode:UIImageRenderingModeAlwaysOriginal];</div><div class="line">self.navigationBar.backIndicatorImage = backButtonImage;</div><div class="line">self.navigationBar.backIndicatorTransitionMaskImage = backButtonImage;</div></pre></td></tr></table></figure></p>
<h3 id="2-安全区域-内容部分"><a href="#2-安全区域-内容部分" class="headerlink" title="2. 安全区域(内容部分)"></a>2. 安全区域(内容部分)</h3><blockquote>
<p>关于安全区域,  tableView废弃了<code>automaticallyAdjustsScrollViewInsets</code>属性; <code>estimatedRowHeight</code>, <code>estimatedSectionHeaderHeight</code> <code>estimatedSectionFooterHeight</code>三个高度估算属性由默认的0变成了<code>UITableViewAutomaticDimension</code>;当然了, 这个是造成UI紊乱的原因, 值得一提的是<strong>tableView的新特性</strong>;</p>
<ul>
<li>设置<code>delaysContentTouches</code>为<code>NO</code>, 不会立即触发cell的响应事件;</li>
<li>两根手指快速的轻击cell，可以同时选中两个cell进入编辑状态。如果两个手指存在不同步问题，则会默认识别其中的一个手指表示单选cell;</li>
<li>新增了一个属性<code>separatorInsetReference</code>可以自定义一个cell分割线的边距;</li>
<li>cell或者表头表尾默认采用自适应高度的方案(造成UI紊乱的原因);</li>
<li>增加了numberOfLines属性来实现类似于UILabel一样的高度自适应变化;</li>
</ul>
</blockquote>
<h5 id="2-1-顶部偏移"><a href="#2-1-顶部偏移" class="headerlink" title="2.1 顶部偏移"></a>2.1 顶部偏移</h5><p><code>automaticallyAdjustsScrollViewInsets</code>属性被废弃，顶部就多了一些偏移;<br><strong>sol 1: </strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">if (@available(iOS 11.0, *)) &#123;</div><div class="line">    self.tableView.contentInsetAdjustmentBehavior = UIScrollViewContentInsetAdjustmentNever;</div><div class="line">&#125; else &#123;</div><div class="line">    self.automaticallyAdjustsScrollViewInsets = NO;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>sol 2: </strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//iOS11 解决SafeArea的问题，同时能解决pop时上级页面scrollView抖动的问题</div><div class="line">if (@available(iOS 11, *)) &#123;</div><div class="line">[UIScrollView appearance].contentInsetAdjustmentBehavior = UIScrollViewContentInsetAdjustmentNever;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>sol 3: </strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">#define  adjustsScrollViewInsets_NO(scrollView,vc)\do &#123; \_Pragma(&quot;clang diagnostic push&quot;) \_Pragma(&quot;clang diagnostic ignored \&quot;-Warc-performSelector-leaks\&quot;&quot;) \if ([UIScrollView instancesRespondToSelector:NSSelectorFromString(@&quot;setContentInsetAdjustmentBehavior:&quot;)]) &#123;\[scrollView  performSelector:NSSelectorFromString(@&quot;setContentInsetAdjustmentBehavior:&quot;) withObject:@(2)];\&#125; else &#123;\vc.automaticallyAdjustsScrollViewInsets = NO;\&#125;\_Pragma(&quot;clang diagnostic pop&quot;) \&#125; while (0)</div></pre></td></tr></table></figure></p>
<p>网友还出现了<strong>webView</strong>会向下移动部分距离的问题;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">if (@available(iOS 11.0, *)) &#123;</div><div class="line">webView.scrollView.contentInsetAdjustmentBehavior = UIScrollViewContentInsetAdjustmentNever;</div><div class="line">&#125; else &#123;</div><div class="line">// Fallback on earlier versions</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h5 id="2-2-cell间隔变大"><a href="#2-2-cell间隔变大" class="headerlink" title="2.2 cell间隔变大"></a>2.2 cell间隔变大</h5><p><strong>sol 1: </strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">self.table.estimatedRowHeight = 0;</div><div class="line">self.table.estimatedSectionHeaderHeight = 0;</div><div class="line">self.table.estimatedSectionFooterHeight = 0;</div></pre></td></tr></table></figure></p>
<p><strong>sol 2: </strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//解决iOS11，仅实现heightForHeaderInSection，没有实现viewForHeaderInSection方法时,section间距大的问题</div><div class="line">[UITableView appearance].estimatedRowHeight = 0;</div><div class="line">[UITableView appearance].estimatedSectionHeaderHeight = 0;</div><div class="line">[UITableView appearance].estimatedSectionFooterHeight = 0;</div></pre></td></tr></table></figure></p>
<h3 id="3-底部区域-tabBar"><a href="#3-底部区域-tabBar" class="headerlink" title="3. 底部区域(tabBar)"></a>3. 底部区域(tabBar)</h3><blockquote>
<p>底部区域主要是iPhoneX与其他机型不一样, 一般机型高度为49, iPhoneX为83;</p>
</blockquote>
<h5 id="适配问题"><a href="#适配问题" class="headerlink" title="适配问题"></a>适配问题</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">#define kTabBarHeight ([[UIApplication sharedApplication] statusBarFrame].size.height&gt;20?83:49)</div></pre></td></tr></table></figure>
<h3 id="4-其他问题"><a href="#4-其他问题" class="headerlink" title="4. 其他问题"></a>4. 其他问题</h3><blockquote>
<p>在IOS11，原有的<code>NSLocationAlwaysUsageDeion</code>被降级为<code>NSLocationWhenInUseUsageDeion</code>;</p>
</blockquote>
<h5 id="4-1-系统获取权限框未弹出"><a href="#4-1-系统获取权限框未弹出" class="headerlink" title="4.1 系统获取权限框未弹出"></a>4.1 系统获取权限框未弹出</h5><p>需要在plist文件中配置<code>NSLocationAlwaysAndWhenInUseUsageDeion</code>，系统框才会弹出;使用requestAlwaysAuthorization获取权限 IOS11系统弹框会把几种权限级别全部列出，供用户选择;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">NSLocationUsageDescription</div><div class="line">获取地理位置，精准推送服务</div><div class="line">NSLocationWhenInUseUsageDescription</div><div class="line">获取地理位置，精准推送服务</div><div class="line">NSLocationAlwaysUsageDescription</div><div class="line">App需要您的同意,才能始终访问位置</div><div class="line">NSLocationAlwaysAndWhenInUseUsageDeion</div><div class="line">App需要您的同意,才能始终访问位置</div></pre></td></tr></table></figure></p>
<h5 id="4-2-iPhone-X上运行缓冲页有黑色区域"><a href="#4-2-iPhone-X上运行缓冲页有黑色区域" class="headerlink" title="4.2 iPhone X上运行缓冲页有黑色区域"></a>4.2 iPhone X上运行缓冲页有黑色区域</h5><p><strong>sol 1: 添加iPhoneX的Launch图1125x2436</strong><br>使用LaunchScreen来当做缓冲页或者修改Assets中的LaunchImage，添加iPhoneX的Launch图1125*2436（竖屏);</p>
<p><strong>sol 2: 修改Contents.json文件</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">&quot;extent&quot; : &quot;full-screen&quot;,</div><div class="line">&quot;idiom&quot; : &quot;iphone&quot;,</div><div class="line">&quot;subtype&quot; : &quot;2436h&quot;,</div><div class="line">&quot;filename&quot; : &quot;1125_2436.png”,</div><div class="line">&quot;minimum-system-version&quot; : &quot;11.0&quot;,</div><div class="line">&quot;orientation&quot; : &quot;portrait&quot;,</div><div class="line">&quot;scale&quot; : &quot;3x&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>sol 2: 使用 LaunchScreen.storyboard 设置启动图</strong><br>使用 LaunchScreen.storyboard 文件将简单视图约束定位，实现各种尺寸的自适应。</p>
<h5 id="4-3-第三方依赖库问题"><a href="#4-3-第三方依赖库问题" class="headerlink" title="4.3 第三方依赖库问题"></a>4.3 第三方依赖库问题</h5><p>ReactiveCocoa Unknown warning group ‘-Wreceiver-is-weak’,ignored警告;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">#define RACObserve(TARGET, KEYPATH) \</div><div class="line">    (&#123; \</div><div class="line">        _Pragma(&quot;clang diagnostic push&quot;) \</div><div class="line">        _Pragma(&quot;clang diagnostic ignored \&quot;-Wreceiver-is-weak\&quot;&quot;) \</div><div class="line">        __weak id target_ = (TARGET); \</div><div class="line">        [target_ rac_valuesForKeyPath:@keypath(TARGET, KEYPATH) observer:self]; \</div><div class="line">        _Pragma(&quot;clang diagnostic pop&quot;) \</div><div class="line">    &#125;)</div></pre></td></tr></table></figure></p>
<h5 id="4-4-xib编译问题"><a href="#4-4-xib编译问题" class="headerlink" title="4.4 xib编译问题"></a>4.4 xib编译问题</h5><p>一般是打开以前的工程, 编译的时候xib报错, 例如:<br><strong><em>warning: Internationalization is not available when compiling for targets before iOS 6.0</em></strong><br>解决办法：<br>选择编译错误的xib文件，找到Builds for 改为iOS 7.0 and Later</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1893416-1290960facc55d59.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h5 id="4-5-相册权限变更"><a href="#4-5-相册权限变更" class="headerlink" title="4.5 相册权限变更"></a>4.5 相册权限变更</h5><p><strong>iOS11以前：</strong><br><code>NSPhotoLibraryUsageDescription</code>：访问相册和存储照片到相册（读写），会出现用户授权;</p>
<p><strong>iOS11之后：</strong><br><code>NSPhotoLibraryUsageDescription</code>：无需添加。默认开启访问相册权限（读），无需用户授权;<br><code>NSPhotoLibraryAddUsageDescription</code>： 添加内容到相册（写），会出现用户授权;</p>
<h5 id="4-6-跳转App-Store评论变更"><a href="#4-6-跳转App-Store评论变更" class="headerlink" title="4.6 跳转App Store评论变更"></a>4.6 跳转App Store评论变更</h5><p><strong>iOS11以前：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">- (void)goToAppStore</div><div class="line">&#123;</div><div class="line"> NSString *itunesurl = @&quot;[http://itunes.apple.com/WebObjects/MZStore.woa/wa/viewContentsUserReviews?id=XXXXXXXX&amp;pageNumber=0&amp;sortOrdering=2&amp;type=Purple](http://itunes.apple.com/WebObjects/MZStore.woa/wa/viewContentsUserReviews?id=XXXXXXXX&amp;pageNumber=0&amp;sortOrdering=2&amp;type=Purple)+Software&amp;mt=8&quot;;</div><div class="line"> [[UIApplication sharedApplication] openURL:[NSURL URLWithString:itunesurl]]; </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>iOS11之后：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">- (void)goToAppStore</div><div class="line">&#123;</div><div class="line">NSString *itunesurl = @</div><div class="line">&quot;itms-[apps://itunes.apple.com/cn/app/idXXXXXX?mt=8&amp;action=write-review](apps://itunes.apple.com/cn/app/idXXXXXX?mt=8&amp;action=write-review)&quot;;</div><div class="line">[[UIApplication sharedApplication] openURL:[NSURL URLWithString:itunesurl]];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>注：XXX为你自己的APP ID;</p>
<p>这些问题是网友们趟过的坑,希望简友们如果遇到过其他问题,  能积极补充, 共同进步;</p>
<h5 id="题外话"><a href="#题外话" class="headerlink" title="题外话"></a>题外话</h5><p>一个人的国庆, 浪不起来, 写篇博客压压惊😓</p>
<blockquote>
<p>参考文章:<br><a href="http://www.cocoachina.com/ios/20170926/20655.html" target="_blank" rel="external">关于iPhone X、iOS 11 、Xcode9，我们应该知道这些</a><br><a href="http://www.jianshu.com/p/18374fbdb972" target="_blank" rel="external">iOS11就问你一句“惊不惊喜？意不意外？”5.8的苦笑。。。。。</a><br><a href="http://www.cocoachina.com/ios/20170929/20683.html" target="_blank" rel="external">iOS11 适配之导航栏、tableView、searchBar遇到的bug</a><br><a href="http://www.cocoachina.com/ios/20170915/20580.html" target="_blank" rel="external">简书App适配iOS 11</a><br><a href="http://www.cocoachina.com/ios/20170925/20642.html" target="_blank" rel="external">10分钟适配 iOS 11 &amp; iPhone X</a><br><a href="http://www.jianshu.com/p/b5067cbc6da3" target="_blank" rel="external">iOS11开发 新增功能大全</a><br><a href="https://juejin.im/post/59cf5a5c5188257e78531557" target="_blank" rel="external">iPhone X + iOS 11 适配指南</a></p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;iOS11最终还是来了, 这次改版屏幕尺寸, 控件特性都有一些比较大的改变. 网上看的问题零零散散, 👇收集了一下开发中出现的问题, 整理一下, 方便之后使用.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1893416-a195c2b81590dd7f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;目录概览&quot;&gt;&lt;br&gt;
    
    </summary>
    
      <category term="iOS" scheme="https://binzi56.github.io/categories/iOS/"/>
    
    
      <category term="iOS" scheme="https://binzi56.github.io/tags/iOS/"/>
    
      <category term="iOS11" scheme="https://binzi56.github.io/tags/iOS11/"/>
    
  </entry>
  
  <entry>
    <title>iOS Google地图开发小结(2017)</title>
    <link href="https://binzi56.github.io/2017/09/26/iOS-GoogleMap/"/>
    <id>https://binzi56.github.io/2017/09/26/iOS-GoogleMap/</id>
    <published>2017-09-26T15:06:29.000Z</published>
    <updated>2017-10-15T01:59:41.000Z</updated>
    
    <content type="html"><![CDATA[<p>最近接触了一个international的项目, 用到Google地图, 在此稍微总结一下, 方便以后使用;</p>
<h3 id="一-准备工作"><a href="#一-准备工作" class="headerlink" title="一. 准备工作"></a>一. 准备工作</h3><p>开发Google地图当然离不开翻墙了, 先分享几个好用的免费翻墙软件:</p>
<h5 id="1-软件"><a href="#1-软件" class="headerlink" title="1.软件:"></a>1.软件:</h5><p><strong><a href="https://www.getlantern.org/en_US/" target="_blank" rel="external">lantern</a></strong><br>(For Window, Mac, Android, Ubuntu)</p>
<p><strong>LetsVPN</strong>(appStore直接下载)<br>(For iOS)<br><a id="more"></a></p>
<h5 id="2-相关资料"><a href="#2-相关资料" class="headerlink" title="2.相关资料:"></a>2.相关资料:</h5><p><a href="https://developers.google.com/maps/documentation/ios-sdk/start?hl=zh-cn" target="_blank" rel="external">Google地图API</a><br>官方Google地图API</p>
<p><a href="https://github.com/nfarina/calloutview" target="_blank" rel="external">SMCalloutView</a><br>这个是点击大头针弹出信息框的自定义视图, 官方地图自定义有局限性, 下面👇会讲到, 示例如图:</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1893416-0b21e2d562a95cc5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="自定义视图"></p>
<h3 id="二-开发内容"><a href="#二-开发内容" class="headerlink" title="二.开发内容"></a>二.开发内容</h3><p>对于iOS开发者, Google地图提供了两个开发入口:<br><a href="https://developers.google.com/maps/documentation/ios-sdk/?hl=zh-cn" target="_blank" rel="external">Maps SDK for iOS</a><br>添加 Google 地图</p>
<p><a href="https://developers.google.com/places/ios-api/?hl=zh-cn" target="_blank" rel="external">Places API for iOS</a><br>添加位置的最新信息</p>
<h5 id="1-Places-API-for-iOS"><a href="#1-Places-API-for-iOS" class="headerlink" title="1.Places API for iOS"></a>1.Places API for iOS</h5><p>这个一般开发Google地图用不到, 不过还是简单说一下, 官方demo截图;</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1893416-69497dbaa0b1ba8d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Places API官方demo截图"></p>
<p>section0: (Autocomplete)<br><img src="http://upload-images.jianshu.io/upload_images/1893416-84c46dcc2f1d7623.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Autocomplete"><br>Autocomplete主要功能是搜索相关的位置信息(文本方式);<br>里面还会展示UISearchBar/UISearchViewController的几种呈现方法, 感兴趣的可以看看;</p>
<p>section1: (Programmatic APIs)</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1893416-658ab6980c184c22.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Programmatic APIs"><br>Programmatic APIs主要展示搜索或所选点附近的信息(地图方式);</p>
<h5 id="2-Maps-SDK-for-iOS"><a href="#2-Maps-SDK-for-iOS" class="headerlink" title="2.Maps SDK for iOS"></a>2.Maps SDK for iOS</h5><p>重点介绍内容, mark, mark….<br>还是一样, 先看下官方demo, 大概浏览一下Google地图的功能;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">//基本组成部分</div><div class="line">Map(地图): 基本的地图创建, 组件, 类别等;</div><div class="line">Panorama(全景): 固定/可旋转的街景;</div><div class="line">Overlays(覆盖物): 地图视图的自定义(地图大头针, 弹出信息框等);</div><div class="line">Camera(摄像头): 当前地图的可视范围(设置摄像头中心点坐标、镜头缩放比例、方向、视角等);</div><div class="line">Services(服务): 地理编码/逆地理编码;</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1893416-1d597406f6308d98.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Maps SDK Demos 结构概览"></p>
<h6 id="2-1-常用类介绍"><a href="#2-1-常用类介绍" class="headerlink" title="2.1 常用类介绍:"></a>2.1 常用类介绍:</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">GMSMapView 最主要的地图类</div><div class="line">GMSCameraPosition 地图摄像头，可以理解为当前地图的可视范围，可以获取到摄像头中心点坐标、镜头缩放比例、方向、视角等参数</div><div class="line">GMSMarker 地图大头针</div><div class="line">GMSGeocoder 反向地理编码类</div><div class="line">GMSAddress 反向地理编码返回的类,包含坐标及地理位置描述等信息</div><div class="line">CLLocationManager 就是CoreLocation框架下的地理位置管理类</div><div class="line">GMSAutocompleteFetcher 搜索自动补全抓取器，通过该类的代理方法实现搜索自动补全</div></pre></td></tr></table></figure>
<h6 id="2-2-常用方法介绍"><a href="#2-2-常用方法介绍" class="headerlink" title="2.2 常用方法介绍:"></a>2.2 常用方法介绍:</h6><p><code>GMSMapViewDelegate</code>:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">mapView:willMove: 镜头即将移动时调用</div><div class="line">mapView:didChangeCameraPosition:镜头移动完成后调用mapView:didTapAtCoordinate: 点击地图时调用</div><div class="line">mapView:didLongPressAtCoordinate: 长按地图时调用</div><div class="line">mapView:didTapMarker: 点击大头针时调用</div><div class="line">mapView:didTapInfoWindowOfMarker: 点击大头针的弹出视窗时调用</div><div class="line">mapView:didLongPressInfoWindowOfMarker: 长按大头针视窗时调用</div><div class="line">mapView:markerInfoWindow: 自定义大头针弹出视窗，返回UIView</div><div class="line">mapView:didCloseInfoWindowOfMarker: 自定义大头针弹出视窗关闭时调用</div><div class="line">mapView:didDragMarker: 拖拽大头针时调用</div><div class="line">didTapMyLocationButtonForMapView: 点击定位大头针, 返回BOOL值</div></pre></td></tr></table></figure></p>
<h6 id="2-3-Google-Maps-URL-架构-单独介绍一下"><a href="#2-3-Google-Maps-URL-架构-单独介绍一下" class="headerlink" title="2.3 Google Maps URL 架构(单独介绍一下):"></a>2.3 Google Maps URL 架构(单独介绍一下):</h6><p>确实与国内不同, Google地图URL架构没在demo中介绍;</p>
<h2 id="👇介绍一下"><a href="#👇介绍一下" class="headerlink" title="👇介绍一下:"></a>👇介绍一下:</h2><blockquote>
<p><strong><em>iOS 版 Google Maps 应用支持以下 URL 架构:</em></strong></p>
<ul>
<li><code>comgooglemaps://</code><br>和 <code>comgooglemaps-x-callback://</code><br>– 这些架构允许您启动 iOS 版 Google Maps 应用，并执行下列几项操作之一：<ul>
<li>以指定的缩放级别显示指定位置的地图。</li>
<li>搜索位置或地点，并将它们显示在地图上。</li>
<li>请求从一个位置前往另一个位置的路线。 可以返回以下四种交通方式的路线：驾车、步行、骑自行车和乘坐公共交通工具。</li>
<li>向应用添加导航。</li>
<li>当应用完成后，使用 <a href="https://developers.google.com/maps/documentation/ios-sdk/urlscheme?hl=zh-cn#specify-a-callback-url" target="_blank" rel="external">comgooglemaps-x-callback://
</a> 发出一个回调。 回调经常用来使用户返回到最初打开 iOS 版 Google Maps 的应用。</li>
</ul>
</li>
<li><code>comgooglemapsurl://</code> – 此架构允许您使用从桌面 Google Maps 网站得到的 URL 启动 iOS 版 Google Maps 应用。 这意味着您可以为用户提供原生移动体验，而不是简单地加载 Google Maps 网站。<ul>
<li>原始 URL 可以是 maps.google.com，或者 google.com/maps，也可以使用任何有效的国家代码顶级域名来代替 com。<ul>
<li>您还可以传递 goo.gl/maps 重定向 URL。<br>您可以将 x-source 和 x-success 参数与 comgooglemapsurl:// URL 架构结合使用来发出回调。</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
</blockquote>
<p><strong>2.3.1 检查设备上是否已安装 Google Maps 应用;</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">if ([[UIApplication sharedApplication] canOpenURL:</div><div class="line">     [NSURL URLWithString:@&quot;comgooglemaps://&quot;]]) &#123;</div><div class="line">      //已安装Google地图APP</div><div class="line">&#125; else &#123;</div><div class="line">     //未安装Google地图APP</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>2.3.2 显示地图</strong><br><strong>参数:</strong></p>
<ul>
<li><code>center</code>：这是地图视口中心点。 其格式为用逗号分隔的字符串 <code>latitude</code>,<code>longitude</code>。</li>
<li><code>mapmode</code>：设置所显示地图的种类。 可以设置为：standard 或 streetview。 如果未指定，则将使用当前的应用设置。</li>
<li><code>views</code>：开启/关闭特定视图。 可以设置为：<code>satellite</code>、<code>traffic</code> 或 <code>transit</code>。 可以使用逗号分隔符来设置多个值。 如果指定了不带任何值的参数，那么将清除所有的视图。</li>
<li><code>zoom</code>：指定地图的缩放级别。<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//示例 URL，它以纽约为中心、采用 14 级缩放级别来显示地图，且开启了交通视图</div><div class="line">comgooglemaps://?center=40.765819,-73.975866&amp;zoom=14&amp;views=traffic</div></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>2.3.3 搜索</strong><br><strong>参数:</strong></p>
<ul>
<li><code>q</code>：用于搜索的查询字符串。<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//示例 URL 用来在指定位置附近搜索“Pizza&quot;</div><div class="line">comgooglemaps://?q=Pizza&amp;center=37.759748,-122.427135</div></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>2.3.4 显示路线</strong><br><strong>参数:</strong></p>
<ul>
<li><code>saddr</code>：设置路线搜索的起点。 它可以是一个纬度、经度或查询格式的地址。 如果它是返回多个结果的查询字符串， 将选择第一个结果。 如果该值留空，那么将使用该用户的当前位置。</li>
<li><code>daddr</code>：设置路线搜索的终点。 具有与 <code>saddr</code> 相同的格式和行为。</li>
<li><code>directionsmode</code>：交通方式。 可以设置为：<code>driving</code>、<code>transit</code>、<code>bicycling</code> 或 <code>walking</code>。<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// 示例 URL 用来显示 Google 纽约办事处与肯尼迪国际机场之间的交通路线</div><div class="line">comgooglemaps://?saddr=Google+Inc,+8th+Avenue,+New+York,+NY&amp;daddr=John+F.+Kennedy+International+Airport,+Van+Wyck+Expressway,+Jamaica,+New+York&amp;directionsmode=transit</div></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>2.3.5 指定回调URL</strong><br><strong>参数:</strong></p>
<ul>
<li><code>x-source</code> – 发送 <code>x-callback</code> 请求的应用的名称。 最好使用短名称。</li>
<li><code>x-success</code> – 完成时调用的 URL。 通常，这是您自己的应用的 URL 架构，可以让用户返回到原来的应用。<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">// 示例将启动 iOS 版 Google Maps 应用，并以纽约为中心显示地图。 该应用还会显示标有“SourceApp”的按钮。 当点击“SourceApp”按钮时，iOS 版 Google Maps 应用将发出一个指向虚拟的 URL 架构的回调， sourceapp://?resume=true.</div><div class="line">comgooglemaps-x-callback://?center=40.765819,-73.975866&amp;zoom=14</div><div class="line">   &amp;x-success=sourceapp://?resume=true</div><div class="line">   &amp;x-source=SourceApp</div></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>2.3.6 向应用添加导航</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">// 代码展示了如何使用 comgooglemaps-x-callback:// 架构来请求路线，然后在您的用户准备就绪后返回到您的应用。 该代码将执行以下操作</div><div class="line">NSURL *testURL = [NSURL URLWithString:@&quot;comgooglemaps-x-callback://&quot;];</div><div class="line">if ([[UIApplication sharedApplication] canOpenURL:testURL]) &#123;</div><div class="line">  NSString *directionsRequest = @&quot;comgooglemaps-x-callback://&quot; +</div><div class="line">      @&quot;?daddr=John+F.+Kennedy+International+Airport,+Van+Wyck+Expressway,+Jamaica,+New+York&quot; +</div><div class="line">      @&quot;&amp;x-success=sourceapp://?resume=true&amp;x-source=AirApp&quot;;</div><div class="line">  NSURL *directionsURL = [NSURL URLWithString:directionsRequest];</div><div class="line">  [[UIApplication sharedApplication] openURL:directionsURL];</div><div class="line">&#125; else &#123;</div><div class="line">  NSLog(@&quot;Can&apos;t use comgooglemaps-x-callback:// on this device.&quot;);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>该代码将执行以下操作：</p>
<ul>
<li>验证 comgooglemaps-x-callback:// URL 架构是否可用。</li>
<li>启动 iOS 版 Google Maps 应用，并请求前往纽约市肯尼迪国际机场的路线。 将起始地址留空即可请求从用户的当前位置出发的路线。</li>
<li>将标记为“AirApp”的按钮添加到 iOS 版 Google Maps 应用中。 该按钮标签由 x-source 参数定义。</li>
<li>当用户点击返回按钮时，调用虚拟 URL 架构 sourceapp://,。</li>
</ul>
<h3 id="三-遇到的问题"><a href="#三-遇到的问题" class="headerlink" title="三.遇到的问题"></a>三.遇到的问题</h3><p>开发中难免遇到一些稀奇古怪的问题, 这里就着我遇到的问题分享一下;</p>
<p><strong>需求:</strong><br>实现一个自定义的弹窗, 要求点击弹窗左边视图返回上一页, 点击右边视图跳转导航功能;</p>
<p><strong>问题:</strong><br>在<code>mapView:markerInfoWindow:</code>中我自定义了一个气泡视图, 视图左右各一个按钮, 按钮的点击方法被屏蔽, 只响应了整个气泡视图的点击方法(<code>mapView:didTapInfoWindowOfMarker:</code>);</p>
<p><strong>解决办法:</strong><br>在试了n个方法后, 终于让我找到了<a href="https://github.com/nfarina/calloutview" target="_blank" rel="external">SMCalloutView</a>, github上的一个自定义气泡的三方, 可以自由定义左右,中间, 背景视图, 非常棒👍, O(∩_∩)O哈哈~</p>
<p>首先是基础操作:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">#import &lt;SMCalloutView/SMCalloutView.h&gt;</div><div class="line"></div><div class="line">static const CGFloat CalloutYOffset = 10.0f;</div><div class="line"></div><div class="line">@interface ViewController ()</div><div class="line">@property (strong, nonatomic) SMCalloutView *calloutView;</div><div class="line">@property (strong, nonatomic) UIView *emptyCalloutView;</div><div class="line">@end</div></pre></td></tr></table></figure></p>
<p>之后初始化<code>SMCalloutView</code>, 创建一个空View;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">- (void)viewDidLoad</div><div class="line">&#123;</div><div class="line">        self.calloutView = [[SMCalloutView alloc] init];</div><div class="line">    self.calloutView.contentView = [UIView new];</div><div class="line"></div><div class="line">    self.emptyCalloutView = [[UIView alloc] initWithFrame:CGRectZero];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>其次是GMSMapViewDelegate里面的设置:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line">- (UIView *)mapView:(GMSMapView *)mapView markerInfoWindow:(GMSMarker *)marker &#123;</div><div class="line">    CLLocationCoordinate2D anchor = marker.position;</div><div class="line"></div><div class="line">    CGPoint point = [mapView.projection pointForCoordinate:anchor];</div><div class="line"></div><div class="line">    self.calloutView.calloutOffset = CGPointMake(0, -CalloutYOffset);</div><div class="line"></div><div class="line">    //SMCalloutView中contentView</div><div class="line">    UIView *googleTipView = [UIView alloc] initWithFrame:CGRectMake(0, 0, 200, 50);</div><div class="line"></div><div class="line">    //左方按钮</div><div class="line">    UIButton *leftButton = [[UIButton alloc] initWithFrame:CGRectMake(0, 0, 100, 50)];</div><div class="line">    [googleTipView addSubview:bView];</div><div class="line">    [leftButton addTarget:self action:@selector(leftButtonClick:) forControlEvents:UIControlEventTouchUpInside];</div><div class="line"></div><div class="line">    //右方按钮</div><div class="line">    UIButton *rightButton = [[UIButton alloc] initWithFrame:CGRectMake(100, 0, 100, 50)];</div><div class="line">    [googleTipView addSubview:bView];</div><div class="line">    [rightButton addTarget:self action:@selector(rightButtonClick:) forControlEvents:UIControlEventTouchUpInside];</div><div class="line"></div><div class="line">    //取消默认背景</div><div class="line">    SMCalloutBackgroundView *calloutBgView = [[SMCalloutBackgroundView alloc] initWithFrame:CGRectZero];</div><div class="line"></div><div class="line">    self.calloutView.backgroundView = calloutBgView;</div><div class="line">    self.calloutView.contentView = googleTipView;</div><div class="line"></div><div class="line">    self.calloutView.hidden = NO;</div><div class="line"></div><div class="line">    CGRect calloutRect = CGRectZero;</div><div class="line">    calloutRect.origin = point;</div><div class="line">    calloutRect.size = CGSizeZero;</div><div class="line"></div><div class="line">    [self.calloutView presentCalloutFromRect:calloutRect</div><div class="line">                                      inView:mapView</div><div class="line">                           constrainedToView:mapView</div><div class="line">                                    animated:YES];</div><div class="line"></div><div class="line">    return self.emptyCalloutView;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)mapView:(GMSMapView *)pMapView didChangeCameraPosition:(GMSCameraPosition *)position &#123;</div><div class="line">    if (pMapView.selectedMarker != nil &amp;&amp; !self.calloutView.hidden) &#123;</div><div class="line">        CLLocationCoordinate2D anchor = [pMapView.selectedMarker position];</div><div class="line"></div><div class="line">        CGPoint arrowPt = self.calloutView.backgroundView.arrowPoint;</div><div class="line">        CGPoint pt = [pMapView.projection pointForCoordinate:anchor];</div><div class="line">        pt.x -= arrowPt.x;</div><div class="line">        pt.y -= arrowPt.y + CalloutYOffset;</div><div class="line"></div><div class="line">        self.calloutView.frame = (CGRect) &#123;.origin = pt, .size = self.calloutView.frame.size &#125;;</div><div class="line">    &#125; else &#123;</div><div class="line">        self.calloutView.hidden = YES;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)mapView:(GMSMapView *)mapView didTapAtCoordinate:(CLLocationCoordinate2D)coordinate &#123;</div><div class="line">    self.calloutView.hidden = YES;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (BOOL)mapView:(GMSMapView *)mapView didTapMarker:(GMSMarker *)marker &#123;</div><div class="line">    mapView.selectedMarker = marker;</div><div class="line">    return YES;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>结果就可以在点击方法里面尽情的调用了:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">//左边按钮点击方法</div><div class="line">- (void)leftButtonClick:(UIButton *)button&#123;</div><div class="line"></div><div class="line">&#125;</div><div class="line">//右边按钮点击方法</div><div class="line">- (void)rightButtonClick:(UIButton *)button&#123;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>最后感谢这位网友的分享, 附上链接:<br><a href="https://stackoverflow.com/questions/15267183/custom-annotation-view-in-google-maps-sdk" target="_blank" rel="external">stackoverflow网友的分享</a></p>
<p>关于Google地图开发:<br><a href="http://www.jianshu.com/p/dc7d267d63d0" target="_blank" rel="external">iOS Google地图SDK入门教程</a><br><a href="http://www.jianshu.com/p/2a1bf192e496" target="_blank" rel="external">iOS－－谷歌地图相关功能的实现</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;最近接触了一个international的项目, 用到Google地图, 在此稍微总结一下, 方便以后使用;&lt;/p&gt;
&lt;h3 id=&quot;一-准备工作&quot;&gt;&lt;a href=&quot;#一-准备工作&quot; class=&quot;headerlink&quot; title=&quot;一. 准备工作&quot;&gt;&lt;/a&gt;一. 准备工作&lt;/h3&gt;&lt;p&gt;开发Google地图当然离不开翻墙了, 先分享几个好用的免费翻墙软件:&lt;/p&gt;
&lt;h5 id=&quot;1-软件&quot;&gt;&lt;a href=&quot;#1-软件&quot; class=&quot;headerlink&quot; title=&quot;1.软件:&quot;&gt;&lt;/a&gt;1.软件:&lt;/h5&gt;&lt;p&gt;&lt;strong&gt;&lt;a href=&quot;https://www.getlantern.org/en_US/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;lantern&lt;/a&gt;&lt;/strong&gt;&lt;br&gt;(For Window, Mac, Android, Ubuntu)&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;LetsVPN&lt;/strong&gt;(appStore直接下载)&lt;br&gt;(For iOS)&lt;br&gt;
    
    </summary>
    
      <category term="iOS" scheme="https://binzi56.github.io/categories/iOS/"/>
    
    
      <category term="iOS" scheme="https://binzi56.github.io/tags/iOS/"/>
    
      <category term="objective-c" scheme="https://binzi56.github.io/tags/objective-c/"/>
    
  </entry>
  
  <entry>
    <title>ionic难点问题整理(持续更新)</title>
    <link href="https://binzi56.github.io/2017/09/09/ionic-diffict-problems/"/>
    <id>https://binzi56.github.io/2017/09/09/ionic-diffict-problems/</id>
    <published>2017-09-09T06:59:57.000Z</published>
    <updated>2017-09-26T15:15:57.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="1-iOS端长数字自动识别为电话，颜色变蓝"><a href="#1-iOS端长数字自动识别为电话，颜色变蓝" class="headerlink" title="1. iOS端长数字自动识别为电话，颜色变蓝"></a>1. iOS端长数字自动识别为电话，颜色变蓝</h4><p>h5:<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;data.mobilePhone&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>效果图:<br><img src="http://upload-images.jianshu.io/upload_images/1893416-962251f0d28d2750.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="系统默认效果"><br><a id="more"></a><br>解决办法:<br>index.html的head中加入代码👇:<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"format-detection"</span> <span class="attr">content</span>=<span class="string">"telephone=no"</span> /&gt;</span></div></pre></td></tr></table></figure></p>
<p>处理后效果图:<br><img src="http://upload-images.jianshu.io/upload_images/1893416-549065ac7a10197c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="处理后效果图"></p>
<h4 id="2-ion-radio设置选中-不可用样式"><a href="#2-ion-radio设置选中-不可用样式" class="headerlink" title="2. ion-radio设置选中/不可用样式"></a>2. ion-radio设置选中/不可用样式</h4><p><strong>设置单选框选中样式:</strong>(仅以背景颜色为例)<br>css:<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.item-radio</span> <span class="selector-tag">input</span><span class="selector-pseudo">:checked</span> + <span class="selector-class">.radio-content</span> <span class="selector-class">.item-content</span> &#123;</div><div class="line">  <span class="attribute">background</span>: <span class="number">#5cbaf0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>设置单选框不可用的样式:</strong>(仅以背景颜色为例)<br>css:<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.item-radio</span> <span class="selector-tag">input</span><span class="selector-pseudo">:disabled</span> + <span class="selector-class">.radio-content</span> <span class="selector-class">.item-content</span> &#123;</div><div class="line">  <span class="attribute">background</span>: <span class="number">#5cbaf0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>附:<br><a href="https://docs.angularjs.org/api/ng/input/input%5Bradio%5D" target="_blank" rel="external">ion-radio API</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;1-iOS端长数字自动识别为电话，颜色变蓝&quot;&gt;&lt;a href=&quot;#1-iOS端长数字自动识别为电话，颜色变蓝&quot; class=&quot;headerlink&quot; title=&quot;1. iOS端长数字自动识别为电话，颜色变蓝&quot;&gt;&lt;/a&gt;1. iOS端长数字自动识别为电话，颜色变蓝&lt;/h4&gt;&lt;p&gt;h5:&lt;br&gt;&lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;p&lt;/span&gt;&amp;gt;&lt;/span&gt;&amp;#123;&amp;#123;data.mobilePhone&amp;#125;&amp;#125;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;p&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;效果图:&lt;br&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1893416-962251f0d28d2750.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;系统默认效果&quot;&gt;&lt;br&gt;
    
    </summary>
    
      <category term="ionic" scheme="https://binzi56.github.io/categories/ionic/"/>
    
    
      <category term="ionic" scheme="https://binzi56.github.io/tags/ionic/"/>
    
  </entry>
  
  <entry>
    <title>为什么我喜欢用SDAutoLayout</title>
    <link href="https://binzi56.github.io/2017/09/02/iOS-SDAutoLayout/"/>
    <id>https://binzi56.github.io/2017/09/02/iOS-SDAutoLayout/</id>
    <published>2017-09-02T05:40:59.000Z</published>
    <updated>2017-09-02T06:00:51.000Z</updated>
    
    <content type="html"><![CDATA[<p>基本的适配方法就不做介绍了, 👇主要介绍一些个人认为的SDAutoLayout适配亮点;</p>
<h3 id="亮点1——-UILabel"><a href="#亮点1——-UILabel" class="headerlink" title="亮点1—— UILabel"></a>亮点1—— UILabel</h3><blockquote>
<p>1.1 label设置最大宽度与行数</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/1893416-877a4ea704dbbae7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="testLabel设置最大宽度与行数"></p>
<p>testLabel设置最大宽度与行数:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">_testLabel.text = @&quot;近段时间，人民币出现快速升值，到底是因为人民币“自强了”，还是美元“弱爆了”？对比美元指数跌幅与人民币对美元升幅，不难发现，美元走弱依旧是推动人民币兑美元汇率升值的主要原因。&quot;;</div><div class="line"></div><div class="line">_testLabel.sd_layout</div><div class="line">.topSpaceToView(self.view, 50)</div><div class="line">.leftSpaceToView(self.view, 20)</div><div class="line">.autoHeightRatio(0);</div><div class="line"></div><div class="line">// 设置最大宽度</div><div class="line">[_testLabel setSingleLineAutoResizeWithMaxWidth:200];</div><div class="line"></div><div class="line">// 设置最大行数</div><div class="line">[_testLabel setMaxNumberOfLinesToShow:3];</div></pre></td></tr></table></figure></p>
<a id="more"></a>
<blockquote>
<p>1.2 label富文本自适应</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/1893416-b246fb68699c7001.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="testLabel富文本自适应"></p>
<p>testLabel富文本自适应:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">NSString *contentStr = @&quot;近段时间，人民币出现快速升值，到底是因为人民币“自强了”，还是美元“弱爆了”？对比美元指数跌幅与人民币对美元升幅，不难发现，美元走弱依旧是推动人民币兑美元汇率升值的主要原因。&quot;;</div><div class="line"></div><div class="line">NSMutableParagraphStyle *paragraphStyle = [[NSMutableParagraphStyle alloc] init];</div><div class="line">[paragraphStyle setLineSpacing:10];</div><div class="line">UIColor *color = [UIColor whiteColor];</div><div class="line">NSAttributedString *contentString = [[NSAttributedString alloc] initWithString:contentStr attributes:@&#123;NSForegroundColorAttributeName : color, NSParagraphStyleAttributeName: paragraphStyle&#125;];</div><div class="line"></div><div class="line"></div><div class="line">_testLabel.attributedText = contentString;</div><div class="line"></div><div class="line">_testLabel.sd_layout</div><div class="line">.leftSpaceToView(self.view, 20)</div><div class="line">.rightSpaceToView(self.view, 20)</div><div class="line">.topSpaceToView(self.view, 100)</div><div class="line">.autoHeightRatio(0);</div><div class="line"></div><div class="line">// 只需执行这步代码, 即可适配富文本</div><div class="line">_testLabel.isAttributedContent = YES;</div></pre></td></tr></table></figure></p>
<h3 id="亮点2——-UIButton"><a href="#亮点2——-UIButton" class="headerlink" title="亮点2—— UIButton"></a>亮点2—— UIButton</h3><blockquote>
<p>2.1 button里的titleLabel和imageView可以分开适配</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/1893416-35c02f01dd06757d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="testButton的titleLabel和imageView分开适配"></p>
<p>testButton代码:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">_testButton.sd_layout</div><div class="line">.centerXEqualToView(self.view)</div><div class="line">.centerYEqualToView(self.view)</div><div class="line">.widthIs(200)</div><div class="line">.heightIs(200);</div><div class="line"></div><div class="line">_testButton.imageView.sd_layout</div><div class="line">.topSpaceToView(_testButton, 20)</div><div class="line">.centerXEqualToView(_testButton)</div><div class="line">.widthIs(100)</div><div class="line">.heightIs(100);</div><div class="line"></div><div class="line">_testButton.imageView.layer.cornerRadius = 50;</div><div class="line">_testButton.imageView.layer.masksToBounds = YES;</div><div class="line"></div><div class="line">_testButton.titleLabel.sd_layout</div><div class="line">.bottomSpaceToView(_testButton, 20)</div><div class="line">.centerXEqualToView(_testButton)</div><div class="line">.leftSpaceToView(_testButton, 20)</div><div class="line">.rightSpaceToView(_testButton, 20)</div><div class="line">.heightIs(40);</div></pre></td></tr></table></figure></p>
<blockquote>
<p>2.2 button根据文字内容自适应大小</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/1893416-52f70969c09b85c0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="testButton根据文字内容自适应"></p>
<p>testButton文字自适应:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[_testButton setTitle:@&quot;testButton文字自适应&quot; forState:UIControlStateNormal];</div><div class="line"></div><div class="line">_testButton.sd_layout</div><div class="line">.centerXEqualToView(self.view)</div><div class="line">.topSpaceToView(self.view, 200);</div><div class="line"></div><div class="line">// 设置button根据文字size自适应</div><div class="line">[_testButton setupAutoSizeWithHorizontalPadding:5 buttonHeight:24];</div></pre></td></tr></table></figure></p>
<h3 id="亮点3——-UIScrollView"><a href="#亮点3——-UIScrollView" class="headerlink" title="亮点3—— UIScrollView"></a>亮点3—— UIScrollView</h3><blockquote>
<p>3.1 scrollView设置类似于collectionView布局效果</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/1893416-0574b50f46b39fa9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="类似collectionView布局效果"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line">// 添加scrollview</div><div class="line">- (void)setupScrollView</div><div class="line">&#123;</div><div class="line">    UIScrollView *scroll = [UIScrollView new];</div><div class="line">    [self.view addSubview:scroll];</div><div class="line">    _testScrollView = scroll;</div><div class="line"></div><div class="line">    // 设置scrollview与父view的边距</div><div class="line">    scroll.sd_layout.spaceToSuperView(UIEdgeInsetsZero);</div><div class="line"></div><div class="line">    [self setupFlowItemContentView];</div><div class="line"></div><div class="line">    // 设置scrollview的contentsize自适应</div><div class="line">    [scroll setupAutoContentSizeWithBottomView:_flowItemContentView bottomMargin:10];</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 添加flowItemContentView</div><div class="line">- (void)setupFlowItemContentView</div><div class="line">&#123;</div><div class="line">    _flowItemContentView = [UIView new];</div><div class="line">    _flowItemContentView.backgroundColor = [[UIColor lightGrayColor] colorWithAlphaComponent:0.4];</div><div class="line">    [_testScrollView addSubview:_flowItemContentView];</div><div class="line"></div><div class="line">    _flowItemContentView.sd_layout</div><div class="line">    .leftEqualToView(_testScrollView)</div><div class="line">    .rightEqualToView(_testScrollView)</div><div class="line">    .topEqualToView(_testScrollView);</div><div class="line"></div><div class="line">    [self setupFlowItemViews];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)setupFlowItemViews</div><div class="line">&#123;</div><div class="line">    NSMutableArray *temp = [NSMutableArray new];</div><div class="line">    for (int i = 0; i &lt; 35; i++) &#123;</div><div class="line">        UIView *view = [UIView new];</div><div class="line">        view.backgroundColor = [self randomColor];</div><div class="line">        [_flowItemContentView addSubview:view];</div><div class="line">        view.sd_layout.autoHeightRatio(0.8);</div><div class="line">        [temp addObject:view];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    // 关键步骤：设置类似collectionView的展示效果</div><div class="line">    [_flowItemContentView setupAutoWidthFlowItems:[temp copy] withPerRowItemsCount:4 verticalMargin:20 horizontalMargin:10 verticalEdgeInset:0 horizontalEdgeInset:0];</div><div class="line"></div><div class="line">//    [_flowItemContentView setupAutoMarginFlowItems:[temp copy] withPerRowItemsCount:10 itemWidth:60 verticalMargin:20 verticalEdgeInset:10 horizontalEdgeInset:0];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>3.2  复杂页面scrollView自适应</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/1893416-0e3e48f35bbbd675.gif?imageMogr2/auto-orient/strip" alt="复杂页面scrollView自适应"></p>
<h3 id="亮点4——-UITableView"><a href="#亮点4——-UITableView" class="headerlink" title="亮点4—— UITableView"></a>亮点4—— UITableView</h3><p>tableView的cell自适应, 自带方法解决;<br>主要有三点需要注意:<br>a. 在tableView的<code>cellForRowAtIndexPath:</code>方法中赋值;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cell.model = model;</div></pre></td></tr></table></figure></p>
<p>b. <code>heightForRowAtIndexPath:</code>里计算行高;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">return [self.tableView cellHeightForIndexPath:indexPath model:model keyPath:@&quot;model&quot; cellClass:currentClass contentViewWidth:[self cellContentViewWith]];</div></pre></td></tr></table></figure></p>
<p>c. cell中适配的时候设置底部边界;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// 当你不确定哪个view在自动布局之后会排布在cell最下方的时候可以调用次方法将所有可能在最下方的view都传过去</div><div class="line">[self setupAutoHeightWithBottomViewsArray:@[_titleLabel, _imageView] bottomMargin:margin];</div></pre></td></tr></table></figure></p>
<p>而且不光如此, 还加入了缓存高度的设置;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// 此步设置用于实现cell的frame缓存，可以让tableview滑动更加流畅</div><div class="line">    [cell useCellFrameCacheWithIndexPath:indexPath tableView:tableView];</div></pre></td></tr></table></figure></p>
<p>是不是比较贴心呢, 当然里面还有一些其他方法, 就不一一列举, 附上官方demo链接, 希望对大家有所帮助;<br><strong><a href="https://github.com/gsdios/SDAutoLayout" target="_blank" rel="external">SDAutoLayout</a></strong></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;基本的适配方法就不做介绍了, 👇主要介绍一些个人认为的SDAutoLayout适配亮点;&lt;/p&gt;
&lt;h3 id=&quot;亮点1——-UILabel&quot;&gt;&lt;a href=&quot;#亮点1——-UILabel&quot; class=&quot;headerlink&quot; title=&quot;亮点1—— UILabel&quot;&gt;&lt;/a&gt;亮点1—— UILabel&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;1.1 label设置最大宽度与行数&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1893416-877a4ea704dbbae7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;testLabel设置最大宽度与行数&quot;&gt;&lt;/p&gt;
&lt;p&gt;testLabel设置最大宽度与行数:&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;_testLabel.text = @&amp;quot;近段时间，人民币出现快速升值，到底是因为人民币“自强了”，还是美元“弱爆了”？对比美元指数跌幅与人民币对美元升幅，不难发现，美元走弱依旧是推动人民币兑美元汇率升值的主要原因。&amp;quot;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;_testLabel.sd_layout&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;.topSpaceToView(self.view, 50)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;.leftSpaceToView(self.view, 20)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;.autoHeightRatio(0);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;// 设置最大宽度&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[_testLabel setSingleLineAutoResizeWithMaxWidth:200];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;// 设置最大行数&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[_testLabel setMaxNumberOfLinesToShow:3];&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="iOS" scheme="https://binzi56.github.io/categories/iOS/"/>
    
    
      <category term="iOS" scheme="https://binzi56.github.io/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>iOS性能优化---tableView懒加载图片</title>
    <link href="https://binzi56.github.io/2017/07/07/iOS-tableView-image/"/>
    <id>https://binzi56.github.io/2017/07/07/iOS-tableView-image/</id>
    <published>2017-07-07T08:47:39.000Z</published>
    <updated>2017-07-07T09:16:59.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://ospquvjh2.bkt.clouddn.com/17-7-7/422937.jpg" alt=""><br>关于tableView的性能优化问题一直都是iOS开发者必备的一项优化技能, 可以好不夸张的说, app里面半数以上的页面都需要用到tableView; 对于它的优化网友也总结的非常详细, 鄙人就不详细解释了, 附个链接:<br><a href="http://www.jianshu.com/p/478b9424ec9b" target="_blank" rel="external">关于tableview的优化</a></p>
<h2 id=""><a href="#" class="headerlink" title=""></a><a id="more"></a></h2><p>本文主要介绍一下如何在tableView中实现懒加载图片, 别怪我多嘴, 一些初学者对懒加载的印象可能是这样的:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">@interface ViewController()</div><div class="line">@property (nonatomic,strong) NSMutableArray *lazyLoadArr;</div><div class="line">@end</div><div class="line">@implementation ViewController</div><div class="line">- (NSMutableArray *)lazyLoadArr</div><div class="line">&#123;</div><div class="line">    if (!_lazyLoadArr) &#123;</div><div class="line">        _lazyLoadArr = [NSMutableArray array];</div><div class="line">    &#125;</div><div class="line">    return _lazyLoadArr;</div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure></p>
<p>实例中定义了一个懒加载的可变数组, 重写数组的getter方法, 在该方法中判断是否存在<code>lazyLoadArr</code>, 如果存在就返回, 不存在就初始化, 这样保证数组只加载了一次; 而这个只是懒加载中比较常见的一种用法;<br>那么什么是懒加载呢?</p>
<blockquote class="blockquote-center"><strong>懒加载</strong>也叫<strong>延迟加载</strong>, 或者通俗来讲就是<strong>用到时再去加载对象</strong></blockquote>

<p>也就是说用到这种思想的基本上都属于懒加载;</p>
<hr>
<p>其实在tableView懒加载图片也是app中比较常见的功能; 它可以可以减轻服务器的压力, 节约流量, 提高页面的加载速度等等, 费这么大劲儿, 最终也是为了更好的用户体验;<br>先附上实现效果图, 让大家感受一下:</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1893416-b3eef803d21197a4.gif?imageMogr2/auto-orient/strip" alt="效果图.gif"><br>这个例子节选自苹果的官方例子LazyTableImages实现图片懒加载;<br><a href="https://developer.apple.com/library/content/samplecode/LazyTableImages/Introduction/Intro.html#//apple_ref/doc/uid/DTS40009394" target="_blank" rel="external">LazyTableImages下载</a></p>
<p>OK, 现在我们开始剖析一下代码;<br>附上工程目录:</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1893416-1a1201fce24801bc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="工程目录.png"></p>
<p>首先说一下细节部分, 其实也不是什么大问题, 留意一下:<br>①工程里面的AppDelegate类被替换成LazyTableAppDelegate, 其实在函数入口main.m替换下类就行;<br>②pch文件导入了Foundation, UIKit框架全局调用, 所以出现了以下情况:</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1893416-d80fea8b4712be69.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="AppRecord.h"></p>
<p>一般对对象的基础操作都放在了Foundation.h, 为了方便, 通常也就直接引入<foundation foundation.h="">;</foundation></p>
<h4 id="数据请求"><a href="#数据请求" class="headerlink" title="数据请求"></a>数据请求</h4><p>为了减少数据延迟加载的卡顿感, demo里直接把数据请求写在了LazyTableAppDelegate文件中; 选一小段代码说一下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">__weak ParseOperation *weakParser = self.parser;</div><div class="line">self.parser.completionBlock = ^(void) &#123;</div><div class="line">    [UIApplication sharedApplication].networkActivityIndicatorVisible = NO;</div><div class="line">    if (weakParser.appRecordList != nil)</div><div class="line">    &#123;</div><div class="line">        dispatch_async(dispatch_get_main_queue(), ^&#123;</div><div class="line">            RootViewController *rootViewController =</div><div class="line">                (RootViewController*)[(UINavigationController*)weakSelf.window.rootViewController topViewController];</div><div class="line">            rootViewController.entries = weakParser.appRecordList;</div><div class="line">            [rootViewController.tableView reloadData];</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">    weakSelf.queue = nil;</div><div class="line">&#125;;</div><div class="line">[self.queue addOperation:self.parser];</div></pre></td></tr></table></figure></p>
<ul>
<li>block循环引用问题, 这个经常遇到, 就不多说了;</li>
<li>数据请求是在子线程里进行了, 然而要想对UI进行操作, 需要回到主线程, 刷新数据;</li>
<li>对于<code>networkActivityIndicatorVisible</code>,  这个是UIApplication的一个属性, 用于在状态栏上显示菊花转的图标，表明网络状态,  而我们平常都是用MB或者SVP来表示网络加载的, 有可能没见过, 说明一下;</li>
</ul>
<h4 id="UI部分-tableView"><a href="#UI部分-tableView" class="headerlink" title="UI部分(tableView)"></a>UI部分(tableView)</h4><p>看了示意图我们发现只有在tableView松开的时候才加载图片, 那这个是怎么实现的呢, 我从tableView的<code>cellForRowAtIndexPath:</code>代理方法中选了一段代码:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">if (!appRecord.appIcon)</div><div class="line">   &#123;</div><div class="line">       if (self.tableView.dragging == NO &amp;&amp; self.tableView.decelerating == NO)</div><div class="line">       &#123;</div><div class="line">           [self startIconDownload:appRecord forIndexPath:indexPath];</div><div class="line">       &#125;</div><div class="line">       cell.imageView.image = [UIImage imageNamed:@&quot;Placeholder.png&quot;];</div><div class="line">   &#125;</div><div class="line">   else</div><div class="line">   &#123;</div><div class="line">      cell.imageView.image = appRecord.appIcon;</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>当没有下载好的图片, 即<code>!appRecord.appIcon</code>时, 判断是否停止拖拽(<code>self.tableView.dragging == NO</code>)或者加速度为0(<code>self.tableView.decelerating == NO</code>), 都满足的话就下载图片, 这样就实现了图示效果;<br>但是光这样处理是不够的, 如果连续拖动, 不让tableView停止, 里面的图片是空的, 所以还要进行下面的操作:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">- (void)scrollViewDidEndDragging:(UIScrollView *)scrollView willDecelerate:(BOOL)decelerate</div><div class="line">&#123;</div><div class="line">    if (!decelerate)</div><div class="line">	&#123;</div><div class="line">        [self loadImagesForOnscreenRows];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)scrollViewDidEndDecelerating:(UIScrollView *)scrollView</div><div class="line">&#123;</div><div class="line">    [self loadImagesForOnscreenRows];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>由于tableView继承了scrollView, 所以才在<code>dragging</code>和<code>decelerating</code>结束的时候加载图片, 最终实现了图示效果;</p>
<h4 id="优化亮点"><a href="#优化亮点" class="headerlink" title="优化亮点"></a>优化亮点</h4><h5 id="一-图片圆角优化"><a href="#一-图片圆角优化" class="headerlink" title="一. 图片圆角优化"></a>一. 图片圆角优化</h5><p>一般在开发中我们是这样给图片切圆角的:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">myImage.layer.cornerRadius = 50;</div><div class="line">myImage.layer.masksToBounds = YES;</div></pre></td></tr></table></figure></p>
<p>其中<code>masksToBounds(CALayer)</code>表示视图的图层上的子图层,如果超出父图层的部分就截取掉；还有<code>clipsToBounds(UIView)</code>，是指视图上的子视图,如果超出父视图的部分就截取掉。<br>在iOS9.0之前这样设置会触发离屏渲染，比较消耗性能。尤其是tableView中(处理了大量图片)，会明显的感到页面有轻微卡顿。<br>那要怎么处理呢, 一般我们用Core Graphics绘制圆角, 附上工程里的代码:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">CGSize itemSize = CGSizeMake(kAppIconSize, kAppIconSize);</div><div class="line">UIGraphicsBeginImageContextWithOptions(itemSize, NO, 0.0f);</div><div class="line">CGRect imageRect = CGRectMake(0.0, 0.0, itemSize.width, itemSize.height);</div><div class="line">[image drawInRect:imageRect];</div><div class="line">self.appRecord.appIcon = UIGraphicsGetImageFromCurrentImageContext();</div><div class="line">UIGraphicsEndImageContext();</div></pre></td></tr></table></figure></p>
<h5 id="二-model的小技巧"><a href="#二-model的小技巧" class="headerlink" title="二. model的小技巧"></a>二. model的小技巧</h5><p>我们发现在工程中, 无论对于tableView来说, 还是下载图片来说, 都是对同一个对象进行操作, demo中把tableView数据里面的对象扩展了下面这两条属性:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">@property (nonatomic, strong) UIImage *appIcon;</div><div class="line">@property (nonatomic, strong) NSString *imageURLString;</div></pre></td></tr></table></figure></p>
<p>这样我们去下载图片的时候, 只需要传进去一个AppRecord类的对象, 返回来也是同一个对象:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"> // 将下载完成的网络图片的data值传给这个对象</div><div class="line">UIImage *image = [[UIImage alloc] initWithData:data];</div><div class="line">self.appRecord.appIcon = image;</div></pre></td></tr></table></figure></p>
<p>有人要问了只是简化了传入的数据嘛, 没什么特别的, 但是你细看tableView里面<code>cellForRowAtIndexPath</code>方法就会发现, 这样做既简化了逻辑判断, 又易于理解, 因为是同一个对象;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">AppRecord *appRecord = (self.entries)[indexPath.row];</div><div class="line">  if (!appRecord.appIcon)         //  简便的判断条件</div><div class="line">        &#123;</div><div class="line">            if (self.tableView.dragging == NO &amp;&amp; self.tableView.decelerating == NO)</div><div class="line">            &#123;</div><div class="line">                [self startIconDownload:appRecord forIndexPath:indexPath];</div><div class="line">            &#125;</div><div class="line">            cell.imageView.image = [UIImage imageNamed:@&quot;Placeholder.png&quot;];</div><div class="line">        &#125;</div><div class="line">        else</div><div class="line">        &#123;</div><div class="line">           cell.imageView.image = appRecord.appIcon;</div><div class="line">        &#125;</div></pre></td></tr></table></figure></p>
<p>这个思想真是不由得让老铁双击666啊, 非常棒👍;</p>
<p>好的, 这次就分享那么多, 以后还得研究更多更深的源码, 加油⛽️;</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://ospquvjh2.bkt.clouddn.com/17-7-7/422937.jpg&quot; alt=&quot;&quot;&gt;&lt;br&gt;关于tableView的性能优化问题一直都是iOS开发者必备的一项优化技能, 可以好不夸张的说, app里面半数以上的页面都需要用到tableView; 对于它的优化网友也总结的非常详细, 鄙人就不详细解释了, 附个链接:&lt;br&gt;&lt;a href=&quot;http://www.jianshu.com/p/478b9424ec9b&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;关于tableview的优化&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;headerlink&quot; title=&quot;&quot;&gt;&lt;/a&gt;
    
    </summary>
    
      <category term="iOS" scheme="https://binzi56.github.io/categories/iOS/"/>
    
    
      <category term="iOS" scheme="https://binzi56.github.io/tags/iOS/"/>
    
      <category term="性能优化" scheme="https://binzi56.github.io/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>《AngularJs权威指南》学习笔记---指令</title>
    <link href="https://binzi56.github.io/2017/07/03/angularjs-bookNote/"/>
    <id>https://binzi56.github.io/2017/07/03/angularjs-bookNote/</id>
    <published>2017-07-03T08:45:16.000Z</published>
    <updated>2017-07-03T06:14:49.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://ooo.0o0.ooo/2017/06/30/5956101095606.png" alt="《AngularJs权威指南》"><br>记得最开始学习ionic混合开发的时候, 朋友们都推荐我先学学angular.js, 然后再看ionic框架的东西; 现在想来也确实, ionic框架基本都是UI相关的知识, 并不难, 而页面里面涉及到angular.js的各种逻辑才是真正能让一个人成为大牛的知识;</p>
<p>选这本书就是因为朋友们都推荐这本, 而且讲的还不错, 最重要的是他们有资源, O(∩_∩)O哈哈~</p>
<p>首先介绍一下本书中关于指令的知识结构:</p>
<p><img src="https://ooo.0o0.ooo/2017/06/30/595622359f429.png" alt="AngularJs权威指南之指令思维导图"><br><a id="more"></a></p>
<h4 id="一-指令简介"><a href="#一-指令简介" class="headerlink" title="一. 指令简介"></a>一. 指令简介</h4><p>用过HTML的都知道, 往往在实现一些特殊功能的时候, 原有的HTML标签并不完全能满足设计要求, 这时候指令就派上用场了; 指令本质上就是扩展一些自定义的HTML元素以实现一些特定的功能;</p>
<h4 id="二-内置指令"><a href="#二-内置指令" class="headerlink" title="二. 内置指令"></a>二. 内置指令</h4><p>AngularJS事实上也是在原生JS的基础上进行一些扩展和优化, 自然就会包括一些自定义的内置指令; 除了form和a等一些重载了原生的HTML元素, 其他的内置指令通常以ng作为前缀; 这样做的目的也是对原生的一种优化, 比如常用的href指令, 无论里面的链接是可用还是, 不可用的, 当调用href的时候, 就会直接返回调用结果; 而ng-href指令则是当里面的表达式调用并且返回一个值的时候才开启, 否则会是一个禁用状态; 当然既然人家官方用ng这个前缀, 你就不要跟人家抢了, 换一个, 大家和谐一点儿;</p>
<p>有网友总结了一下AngularJS的内置指令, 一共有63个;</p>
<p><img src="https://ooo.0o0.ooo/2017/07/02/595868ba9db00.png" alt=""></p>
<p>简单介绍一下form指令:<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></div><div class="line">First name:<span class="tag">&lt;/<span class="name">br</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"firstname"</span> <span class="attr">value</span>=<span class="string">"huo"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span></div><div class="line">Last name:<span class="tag">&lt;/<span class="name">br</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"lastname"</span> <span class="attr">value</span>=<span class="string">"yu"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Submit"</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>效果图:</p>
<p><img src="https://ooo.0o0.ooo/2017/07/02/59586ae064bcd.png" alt=""></p>
<p>要注意一下几点:</p>
<ul>
<li>HTML原生的form表单是不能嵌套的, 但Angular封装后可以嵌套</li>
<li>Angular为form扩展了自动校验, 防止重复提交等功能</li>
<li>Angular对input元素的type进行了了扩展, 一共提供一下10中类型:<br>text, number, url, email, radio, checkbox, hidden, button, submit, reset;</li>
<li>Angular为表单内置了4种CSS样式<br>ng-valid, ng-invalid, ng-pristine, ng-dirty;</li>
<li>内置校验器: require, minlength, maxlength</li>
</ul>
<h4 id="三-指令详解"><a href="#三-指令详解" class="headerlink" title="三. 指令详解"></a>三. 指令详解</h4><h5 id="1-指令定义"><a href="#1-指令定义" class="headerlink" title="1. 指令定义"></a>1. 指令定义</h5><p>本书中对指令的定义是在特定DOM元素上运行的函数, 指令可以扩展这个元素的功能;<br>在Angular中是通过directive()这个模块来定义指令的;而directive()可以接受两个参数:</p>
<ul>
<li>name<br>指令的名字</li>
<li>factory_function(函数)<br>这个函数定义了指令的行为<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"> angular.application(<span class="string">'myApp'</span>, [])</div><div class="line">     .directive(<span class="string">'myDirective'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">     <span class="comment">//  一个指令定义对象</span></div><div class="line">     <span class="keyword">return</span> &#123;</div><div class="line">             <span class="comment">//  通过设置项来定义指令, 在这里进行填写</span></div><div class="line">            &#125;;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
</ul>
<p>在HTML中调用就行:<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">my-directive</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h5 id="2-指令函数介绍"><a href="#2-指令函数介绍" class="headerlink" title="2. 指令函数介绍"></a>2. 指令函数介绍</h5><p><strong>2.1 restrict(字符串)</strong></p>
<p><img src="https://ooo.0o0.ooo/2017/07/02/5958743024814.png" alt=""></p>
<p>这些选项可以单独使用, 也可以混合使用;</p>
<p><strong>2.2 优先级(数值型)</strong><br>由于考虑到性能问题, ngRepeat被设置成所有内置指令中优先级最高的; 当然如果两个元素的优先级一样, 会执行先声明的那个;</p>
<p><strong>2.3 terminal(布尔型)</strong><br>它用来告诉AngularJs停止运行当前元素上比本指令优先级低的指令, 但当优先级相同的情况还是会运行;<br>例如:ngView和ngIf, ngIf的优先级略高于ngView, 如果ngIf表达式为true, ngView就可以被正常执行; 但如果ngIf的表达式为false, ngView就不会被执行;</p>
<p><strong>2.4 template(字符串或函数)</strong><br>template参数必须被设置成以下两种形式之一:</p>
<ul>
<li>一段HTML文本</li>
<li>一个可以接受两个参数的的函数, 参数为tElement和tAttrs, 并返回一个代表模板的字符串;</li>
</ul>
<p><strong>2.5 templateUrl(字符串或函数)</strong><br>templateUrl参数可以是以下形式:</p>
<ul>
<li>一个代表外部HTML文件的路径字符串</li>
<li>一个可以接受两个参数的的函数, 参数为tElement和tAttrs, 并返回一个代表模板的字符串;</li>
</ul>
<p><strong>2.6 replace(布尔型)</strong><br>replace是个可选参数, 默认为false; 当设置为true后<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">.directive(<span class="string">'someDirective'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">         <span class="keyword">return</span> &#123;</div><div class="line">             <span class="attr">replace</span>: <span class="literal">true</span></div><div class="line">             template: <span class="string">'&lt;div&gt;looking for something&lt;div&gt;'</span></div><div class="line">                &#125;;</div><div class="line"> &#125;);</div></pre></td></tr></table></figure></p>
<p>输出结果为:<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>looking for something<span class="tag">&lt;<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p><strong>2.7 scope参数(布尔型或对象)</strong><br>scope参数有三种取值方式;<br><strong>2.7.1 false(默认值)</strong><br>直接使用父scope, 内部并没有一个新的scope，它和指令以外的代码共享同一个scope。<br>①指令<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">app.directive(<span class="string">'myDirective'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        <span class="attr">restrict</span>: <span class="string">'E'</span>,</div><div class="line">        <span class="attr">replace</span>: <span class="literal">true</span>,</div><div class="line">        <span class="attr">templateUrl</span>: <span class="string">'../templates/my_template.html'</span>,</div><div class="line">        <span class="attr">scope</span>: <span class="literal">false</span>,   <span class="comment">// 默认值</span></div><div class="line">        controller: <span class="literal">null</span></div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>②指令模板(my_template.html)<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!--这里ng-model绑定的input，就是父scope的变量input--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>自定义指令scope：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">ng-model</span>=<span class="string">"input"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>结果：&#123;&#123;input&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>③指令的使用(index.html)<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-app</span>=<span class="string">"scopeTest"</span> <span class="attr">ng-controller</span>=<span class="string">"scopeTestStr"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>父scope：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">ng-model</span>=<span class="string">"input"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!--自定义指令--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">my-directive</span>&gt;</span><span class="tag">&lt;/<span class="name">my-directive</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>效果如下:</p>
<p><img src="https://ooo.0o0.ooo/2017/07/03/5959b443bb7d1.gif" alt=""></p>
<p><strong>2.7.2 true</strong>(继承父scope)<br>当设置为true的时候, 会从父作用域继承并创建一个新的作用域对象;<br>参照值为false的情况, 只是将值改为true; 效果如下:</p>
<p><img src="https://ooo.0o0.ooo/2017/07/03/5959b5dfe7c63.gif" alt=""></p>
<p><strong>2.7.3 { }</strong><br>创建一个新的”隔离”scope，但仍可与父scope通信;<br>隔离的scope，通常用于创建可复用的指令，也就是它不用管父scope中的model。然而虽然说是“隔离”，但通常我们还是需要让这个子scope跟父scope中的变量进行绑定。绑定的策略有3种：</p>
<p><img src="https://ooo.0o0.ooo/2017/07/03/5959aee692741.png" alt=""></p>
<p>①@ 单项绑定<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-app</span>=<span class="string">"scopeTest"</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!--外部scope--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>父scope：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">ng-model</span>=<span class="string">"input"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!--内部隔离scope--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">my-directive</span> <span class="attr">my-text</span>=<span class="string">"&#123;&#123;input&#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">my-directive</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">        <span class="keyword">var</span> app = angular.module(<span class="string">'scopeTest'</span>, []);</div><div class="line">        app.directive(<span class="string">'myDirective'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">return</span> &#123;</div><div class="line">                <span class="attr">restrict</span>: <span class="string">'E'</span>,</div><div class="line">                <span class="attr">replace</span>: <span class="literal">true</span>,</div><div class="line">                <span class="attr">template</span>: <span class="string">'&lt;p&gt;自定义指令scope：&lt;input type="text" ng-model="myText"&gt;&lt;/p&gt;'</span>,</div><div class="line">                <span class="attr">scope</span>: &#123;</div><div class="line">                    <span class="attr">myText</span>: <span class="string">'@'</span></div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>效果图:</p>
<p><img src="https://ooo.0o0.ooo/2017/07/03/5959b6e8e19ad.gif" alt=""></p>
<p>②= 双向绑定<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-app</span>=<span class="string">"scopeTest"</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!--外部scope--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>父scope：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">ng-model</span>=<span class="string">"input"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="comment">&lt;!--内部隔离scope--&gt;</span></div><div class="line">    <span class="comment">&lt;!--注意这里，因为是双向绑定，所以这里不要“&#123;&#123;&#125;&#125;”这个符号--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">my-directive</span> <span class="attr">my-text</span>=<span class="string">"input"</span>&gt;</span><span class="tag">&lt;/<span class="name">my-directive</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">        <span class="keyword">var</span> app = angular.module(<span class="string">'scopeTest'</span>, []);</div><div class="line">        app.directive(<span class="string">'myDirective'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">return</span> &#123;</div><div class="line">                <span class="attr">restrict</span>: <span class="string">'E'</span>,</div><div class="line">                <span class="attr">replace</span>: <span class="literal">true</span>,</div><div class="line">                <span class="attr">template</span>: <span class="string">'&lt;p&gt;自定义指令scope：&lt;input type="text" ng-model="myText"&gt;&lt;/p&gt;'</span>,</div><div class="line">                <span class="attr">scope</span>: &#123;</div><div class="line">                    <span class="attr">myText</span>: <span class="string">'='</span> <span class="comment">// 这里改成了双向绑定</span></div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>效果图:</p>
<p><img src="https://ooo.0o0.ooo/2017/07/03/5959b77332f29.gif" alt=""></p>
<p>③&amp; 内部scope的函数返回值和外部scope绑定<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-app</span>=<span class="string">"scopeTest"</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!--外部scope--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>父scope：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">ng-model</span>=<span class="string">"input"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="comment">&lt;!--内部隔离scope--&gt;</span></div><div class="line">    <span class="comment">&lt;!--注意这里，函数名字也要用 连字符命名法--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">my-directive</span> <span class="attr">get-my-text</span>=<span class="string">"input"</span>&gt;</span><span class="tag">&lt;/<span class="name">my-directive</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">        <span class="keyword">var</span> app = angular.module(<span class="string">'scopeTest'</span>, []);</div><div class="line">        app.directive(<span class="string">'myDirective'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">return</span> &#123;</div><div class="line">                <span class="attr">restrict</span>: <span class="string">'E'</span>,</div><div class="line">                <span class="attr">replace</span>: <span class="literal">true</span>,</div><div class="line">                <span class="attr">template</span>: <span class="string">'&lt;p&gt;结果：&#123;&#123; getMyText() &#125;&#125;&lt;/p&gt;'</span>,</div><div class="line">                <span class="attr">scope</span>: &#123;</div><div class="line">                    <span class="attr">getMyText</span>: <span class="string">'&amp;'</span> <span class="comment">// 这里改成了函数返回值的绑定</span></div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>效果图:</p>
<p><img src="https://ooo.0o0.ooo/2017/07/03/5959b7cd90cdd.gif" alt=""></p>
<p><strong>2.8 transclude(布尔型)</strong><br>默认为false; 只有当你希望创建一个可以包含任意内容的指令的时候才会为true; 代码如下所示:<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">app.directive('myDirective', function() &#123;</div><div class="line">    return &#123;</div><div class="line">        restrict: 'AE',</div><div class="line">        transclude: true,</div><div class="line">        template: "<span class="tag">&lt;<span class="name">div</span>&gt;</span> hellow angular ! <span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-transclude</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>"</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p><strong>2.9 controller(字符串或函数)</strong><br>指令内部的controller, 暴露一些public方法给内部指令使用;<br>①字符串;<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">angular.module(<span class="string">'myApp'</span>, [])</div><div class="line">  .directive(<span class="string">'myDirective'</span>,  <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">     restrict: <span class="string">'A'</span>, <span class="comment">// 始终需要</span></div><div class="line">     controller: <span class="string">'SomeController'</span></div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="comment">// 在应用中其他地方定义该控制器</span></div><div class="line">angular.module(<span class="string">'myApp'</span>)</div><div class="line">   .controller(<span class="string">'SomeController'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$scope, $element, $attrs, $transclude</span>) </span>&#123;</div><div class="line">        <span class="comment">// 控制器逻辑</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>②函数<br>可以是指令内部通过匿名构造函数的方式来定义一个内联的控制器;<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"> angular.module(<span class="string">'myApp'</span>,[])</div><div class="line">     .directive(<span class="string">'myDirective'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">         restrict: <span class="string">'A'</span>,</div><div class="line">         <span class="attr">controller</span>:</div><div class="line">         <span class="function"><span class="keyword">function</span>(<span class="params">$scope, $element, $attrs, $transclude</span>) </span>&#123;</div><div class="line">               <span class="comment">// 控制器逻辑</span></div><div class="line">        &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>现在你也可以知道, 控制器中还有其他一些特殊的服务可以注入到指令中, 这些服务有:</p>
<ul>
<li>$scope  指令对应的作用域</li>
<li>$element  指令对应的元素</li>
<li>$attrs  当前元素属性组成的对象</li>
<li>$transclude  嵌入链式函数会与对应的嵌入作用域进行预绑定</li>
</ul>
<blockquote>
<p>在控制器内部操作DOM和angular.js风格相悖的做法, 但通过链式函数就可以实现这个需求; 例如在compile参数中使用transcludeFn是推荐的做法;</p>
</blockquote>
<p>本文提供了一个添加超链接的例子:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"> angular.module(<span class="string">'myApp'</span>)</div><div class="line">     .directive(<span class="string">'link'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">      <span class="keyword">return</span> &#123;</div><div class="line">          <span class="attr">restrict</span>: <span class="string">'EA'</span>,</div><div class="line">          <span class="attr">transclude</span>: <span class="literal">true</span>,</div><div class="line">          <span class="attr">controller</span>:</div><div class="line">               <span class="function"><span class="keyword">function</span>(<span class="params">$scope, $element, $transclude, $log</span>) </span>&#123;</div><div class="line">               $transclude(<span class="function"><span class="keyword">function</span>(<span class="params">clone</span>) </span>&#123;</div><div class="line">                    <span class="keyword">var</span> a = angular.element(<span class="string">'&lt;a&gt;'</span>);</div><div class="line">                    a.attr(<span class="string">'href'</span>, clone.text());</div><div class="line">                    a.text(clone.text()); <span class="number">8</span> $log.info(<span class="string">"Created new a tag in link directive"</span>);</div><div class="line">                    $element.append(a);</div><div class="line">               &#125;);</div><div class="line">          &#125;</div><div class="line">      &#125;;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>link函数可以与控制器指令的控制器互换; 控制器用来提供指令间的复用行为, 但链接函数只能在当前内部指令中定义行为且无法在指令间复用;</p>
<blockquote>
<p>link函数可以将指令互相隔离, 而controller则定义可复用的行为;</p>
</blockquote>
<p>下面附一张link函数与compile函数的比较图:</p>
<p><img src="https://ooo.0o0.ooo/2017/07/03/5959c0b371aa4.png" alt=""></p>
<p><strong>2.10 require(字符串或数组)</strong><br>字符串或数组的值会是当前指令作用域中使用的指令名称, 即用来调用暴露的内部方法;</p>
<p>对于指令的学习, 书中提供了内部原理, 当然光这些还是远远不够, 附上一个第三方指令库, 看看源码, 体验一下别人是怎么写的;<br><a href="https://angular-ui.github.io/" target="_blank" rel="external">AngularUI</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;https://ooo.0o0.ooo/2017/06/30/5956101095606.png&quot; alt=&quot;《AngularJs权威指南》&quot;&gt;&lt;br&gt;记得最开始学习ionic混合开发的时候, 朋友们都推荐我先学学angular.js, 然后再看ionic框架的东西; 现在想来也确实, ionic框架基本都是UI相关的知识, 并不难, 而页面里面涉及到angular.js的各种逻辑才是真正能让一个人成为大牛的知识;&lt;/p&gt;
&lt;p&gt;选这本书就是因为朋友们都推荐这本, 而且讲的还不错, 最重要的是他们有资源, O(∩_∩)O哈哈~&lt;/p&gt;
&lt;p&gt;首先介绍一下本书中关于指令的知识结构:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://ooo.0o0.ooo/2017/06/30/595622359f429.png&quot; alt=&quot;AngularJs权威指南之指令思维导图&quot;&gt;&lt;br&gt;
    
    </summary>
    
      <category term="js" scheme="https://binzi56.github.io/categories/js/"/>
    
    
      <category term="angular.js" scheme="https://binzi56.github.io/tags/angular-js/"/>
    
      <category term="读书笔记" scheme="https://binzi56.github.io/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>Lottie动画教程</title>
    <link href="https://binzi56.github.io/2017/07/03/lottie-simple-tutorial/"/>
    <id>https://binzi56.github.io/2017/07/03/lottie-simple-tutorial/</id>
    <published>2017-07-03T07:02:17.000Z</published>
    <updated>2017-07-03T10:11:06.000Z</updated>
    
    <content type="html"><![CDATA[<p>为了提升用户体验, 在界面中加入一个设计良好的界面动画成为app设计的潮流. 之前听有人说过专业的界面动画是要有设计师、工程师、程序员、平面动画师等组成, 想想这是一个多大的任务量啊. 而且里面的各种逻辑处理, 复杂一些的动画, 一般人几乎是望其项背;</p>
<p>但有了Lottie之后, 就大大降低了开发者的难度. 我们可以直接把Lottie的动画文件导入, 设置一下参数, 就可以使用这个动画了. 为了满足大家的好奇心, 先附几个简单的实例:</p>
<p><img src="https://ooo.0o0.ooo/2017/07/03/5959f6801b403.gif" alt="Lottie简单实例"><br><a id="more"></a></p>
<h3 id="一-初识Lottie"><a href="#一-初识Lottie" class="headerlink" title="一. 初识Lottie"></a>一. 初识Lottie</h3><p>通过AE上的<strong>Bodymovin</strong>插件将AE中制作好的动画导出成一个json文件，Lottie实现了iOS/macOS/Android/React Native三个平台对该json文件的解析和渲染。</p>
<p><img src="https://ooo.0o0.ooo/2017/07/03/5959faf3c48e8.gif" alt=""></p>
<p><img src="https://ooo.0o0.ooo/2017/07/03/5959fb0ca228a.gif" alt=""></p>
<p><img src="https://ooo.0o0.ooo/2017/07/03/5959fb1572714.gif" alt=""></p>
<p>所有这些动画都是在After Effects中创建的，使用Bodymovin导出，并且无需额外的工程师工作即可完成原生渲染。</p>
<p>Bodymovin是一个又Hernan Torrisi创建的After Effects插件，导出文件格式为json和包括一个javascript网络播放器。而它最大的优点是提供了一套完整的跨平台动画实现工作流;</p>
<p><img src="https://ooo.0o0.ooo/2017/07/03/5959fbad40e8f.png" alt=""></p>
<p>从代码上看，iOS端是基于layer，而最终都是对canvas的操作，中间除去解析json外，基本无耗费性能的行为。</p>
<p>当然也不可能都那么完美, 毕竟开源不久, 它仍然存在以下问题:</p>
<ol>
<li>Bodymovin插件待完善，仍然有部分AE效果无法成功导出；</li>
<li>Lottie对json文件的支持待完善，目前有部分能成功导出成json文件的效果在移动端上无法很好的展现；</li>
<li>目前不支持文字，所有文字必须转成矢量图才能正常展现动画；</li>
<li>动画无法被编辑，即移动端无法更改远端下载到本地的动画；</li>
<li>文档更新不及时等;<br>注:<br>iOS需要iOS8及以上, 安卓需要API14及以上;</li>
</ol>
<h3 id="二-如何用Bodymovin插件制作动画"><a href="#二-如何用Bodymovin插件制作动画" class="headerlink" title="二. 如何用Bodymovin插件制作动画"></a>二. 如何用Bodymovin插件制作动画</h3><p>iTerryWang在他的简书博客里详细介绍了如何使用Bodymovin插件制作动画, 我就不多说了, 也同时感谢一下iTerryWang的分享;<br><a href="http://www.jianshu.com/p/94f7a0102be5" target="_blank" rel="external">Lottie简介 &amp; iOS集成使用</a></p>
<h3 id="三-如何使用Lottie"><a href="#三-如何使用Lottie" class="headerlink" title="三. 如何使用Lottie"></a>三. 如何使用Lottie</h3><p><strong>1. 下载Lottie动画文件</strong><br>除了用Bodymovin插件创建动画外, 我们还可以在<a href="https://www.lottiefiles.com" target="_blank" rel="external">Lottie Files</a>下载;</p>
<p><img src="https://ooo.0o0.ooo/2017/07/03/595a05e7c4ccf.png" alt=""><br>Lottie Files是一个拥有高质量Lottie文件格式动画的网站。在这个网站，不仅设计师可以在上面陈列他们的动画而且还提供免费下载. 这步结束后, 我们就准备好了动画所需的JSON文件;</p>
<p><strong>2. 新建工程</strong><br>新建一个工程, 命名为LottieTest;</p>
<p><img src="https://ooo.0o0.ooo/2017/07/03/595a080c273b8.png" alt=""></p>
<p><strong>3. 导入Lottie动画库</strong><br>用CocoaPods安装Lottie动画库:<br>在终端进行如下操作:<br>①进入文件目录(文件目录要用自己的工程目录);<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cd /Users/apple/Desktop/LottieTest</div></pre></td></tr></table></figure></p>
<p>②创建podfile<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pod init</div></pre></td></tr></table></figure></p>
<p>③打开文件编辑<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">target <span class="string">'LottieTest'</span> <span class="keyword">do</span></div><div class="line">  pod <span class="string">'lottie-ios'</span></div><div class="line">end</div></pre></td></tr></table></figure></p>
<p>④导入Lottie项目<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pod install</div></pre></td></tr></table></figure></p>
<p><strong>4. 添加Lottie动画的JSON文件</strong><br>之前已经准备好这个文件了, 导入工程就行;</p>
<p><strong>5. 创建动画</strong><br>OC版:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">#import &quot;ViewController.h&quot;</div><div class="line">#import &lt;Lottie/Lottie.h&gt;</div><div class="line"></div><div class="line">@interface ViewController ()</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line">@implementation ViewController</div><div class="line"></div><div class="line">- (void)viewDidLoad &#123;</div><div class="line">    [super viewDidLoad];</div><div class="line"></div><div class="line">    LOTAnimationView *lottieTest = [LOTAnimationView animationNamed:@&quot;servishero_loading&quot;];</div><div class="line">    lottieTest.contentMode = LOTViewContentModeScaleAspectFill;</div><div class="line">    lottieTest.frame = self.view.bounds;</div><div class="line">    lottieTest.autoresizingMask = NSViewWidthSizable | NSViewHeightSizable;</div><div class="line">    [self.view addSubview:lottieTest];</div><div class="line">    [lottieTest play];</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure></p>
<p>swift版:<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> UIKit</div><div class="line"><span class="keyword">import</span> Lottie</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.viewDidLoad()</div><div class="line">        <span class="keyword">if</span> <span class="keyword">let</span> animationView = <span class="type">LOTAnimationView</span>(name: <span class="string">"servishero_loading"</span>) &#123;</div><div class="line"><span class="comment">//        if let animationView = LOTAnimationView(contentsOf: URL(string: "https://github.com/airbnb/lottie-ios/raw/master/Example/Assets/LottieLogo1.json")!) &#123;</span></div><div class="line">            animationView.frame = <span class="keyword">self</span>.view.bounds</div><div class="line">            animationView.center = <span class="keyword">self</span>.view.center</div><div class="line"></div><div class="line">            animationView.loopAnimation = <span class="literal">true</span></div><div class="line">            animationView.contentMode = .scaleAspectFill</div><div class="line">            animationView.animationSpeed = <span class="number">0.5</span></div><div class="line"></div><div class="line">            <span class="comment">// Applying UIView animation</span></div><div class="line">            <span class="keyword">let</span> minimizeTransform = <span class="type">CGAffineTransform</span>(scaleX: <span class="number">0.1</span>, y: <span class="number">0.1</span>)</div><div class="line">            animationView.transform = minimizeTransform</div><div class="line">            <span class="type">UIView</span>.animate(withDuration: <span class="number">3.0</span>, delay: <span class="number">0.0</span>, options: [.<span class="keyword">repeat</span>, .autoreverse], animations: &#123;</div><div class="line">                animationView.transform = <span class="type">CGAffineTransform</span>.identity</div><div class="line">            &#125;, completion: <span class="literal">nil</span>)</div><div class="line"></div><div class="line">            view.addSubview(animationView)</div><div class="line"></div><div class="line">            animationView.play()</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>至于android, reactNative参照下方github地址:<br><a href="https://github.com/airbnb/lottie-android" target="_blank" rel="external">android</a><br><a href="https://github.com/airbnb/lottie-react-native" target="_blank" rel="external">reactNative</a></p>
<p>扩展:<br><a href="http://www.jianshu.com/p/19106e3d07b2" target="_blank" rel="external">Airbnb 动画库Lottie</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;为了提升用户体验, 在界面中加入一个设计良好的界面动画成为app设计的潮流. 之前听有人说过专业的界面动画是要有设计师、工程师、程序员、平面动画师等组成, 想想这是一个多大的任务量啊. 而且里面的各种逻辑处理, 复杂一些的动画, 一般人几乎是望其项背;&lt;/p&gt;
&lt;p&gt;但有了Lottie之后, 就大大降低了开发者的难度. 我们可以直接把Lottie的动画文件导入, 设置一下参数, 就可以使用这个动画了. 为了满足大家的好奇心, 先附几个简单的实例:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://ooo.0o0.ooo/2017/07/03/5959f6801b403.gif&quot; alt=&quot;Lottie简单实例&quot;&gt;&lt;br&gt;
    
    </summary>
    
      <category term="iOS" scheme="https://binzi56.github.io/categories/iOS/"/>
    
    
      <category term="iOS" scheme="https://binzi56.github.io/tags/iOS/"/>
    
      <category term="android" scheme="https://binzi56.github.io/tags/android/"/>
    
      <category term="动画" scheme="https://binzi56.github.io/tags/%E5%8A%A8%E7%94%BB/"/>
    
  </entry>
  
  <entry>
    <title>关于IPV6审核被拒的完整分析</title>
    <link href="https://binzi56.github.io/2017/06/30/appStore-ipv6/"/>
    <id>https://binzi56.github.io/2017/06/30/appStore-ipv6/</id>
    <published>2017-06-30T02:18:16.000Z</published>
    <updated>2017-06-30T07:32:32.000Z</updated>
    
    <content type="html"><![CDATA[<p>自从去年6月1号Apple明文规定所有开发者提交新版本都必须支持IPV6-Only的网络，估计很多iOS开发者都遇到由于IPV6网络不支持造成的审核被拒的情况, 我被坑的不轻啊, 下面就来分析一下IPV6问题如何解决。</p>
<p>首先附一个审核被拒的原文:</p>
<blockquote>
<p>Guideline 2.1 - Performance - App Completeness<br>  We discovered one or more bugs in your app when reviewed on iPad running iOS 10.3.2 on Wi-Fi connected to an IPv6 network.<br>  Specifically, the app launched to a blank page.<br>  Please see attached screenshots for details.</p>
<p>Next Steps<br>  To resolve this issue, please run your app on a device while connected to an IPv6 network (all apps must support IPv6) to identify any issues, then revise and resubmit your app for review.<br>  If we misunderstood the intended behavior of your app, please reply to this message in Resolution Center to provide information on how these features were intended to work.<br>  For new apps, uninstall all previous versions of your app from a device, then install and follow the steps to reproduce the issue. For updates, install the new version as an update to the previous version, then follow the steps to reproduce the issue.</p>
</blockquote>
<a id="more"></a>
<p>大意是在iPad上运行iOS 10.3.2 wi - fi连接到IPv6网络, 应用程序启动是一个空白页。请在设备上运行您的应用程序,连接到IPv6网络, 然后修改并重新提交你的应用程序进行审查。</p>
<h3 id="一-简单介绍一下IPV6以及如何搭建检测环境"><a href="#一-简单介绍一下IPV6以及如何搭建检测环境" class="headerlink" title="一. 简单介绍一下IPV6以及如何搭建检测环境"></a>一. 简单介绍一下IPV6以及如何搭建检测环境</h3><p>首先IPV6，是对IPV4地址空间的扩充。目前当我们用iOS设备连接上Wifi、4G、3G等网络时，设备被分配的地址均是IPV4地址，但是随着运营商和企业逐渐部署IPV6 DNS64/NAT64网络之后，设备被分配的地址会变成IPV6的地址，而这些网络就是所谓的IPV6-Only网络，并且仍然可以通过此网络去获取IPV4地址提供的内容。简单来说就是IPV4不够用了, 要换IPV6, 这从苹果一向的以用户体验为主出发, 其实也是为了让用户能用着舒服;<br>测试是否支持IPV6网上已有更多详细的方法, 照着搭建就行, 下方附搭建环境的方法:</p>
<ul>
<li><a href="https://developer.apple.com/library/mac/documentation/NetworkingInternetWeb/Conceptual/NetworkingOverview/UnderstandingandPreparingfortheIPv6Transition/UnderstandingandPreparingfortheIPv6Transition.html#//apple_ref/doc/uid/TP40010220-CH213-SW1" target="_blank" rel="external">苹果官方文档的搭建方法</a></li>
<li><a href="http://blog.csdn.net/iosworker/article/details/51595432" target="_blank" rel="external">苹果app上架因IPv6不支持而拒绝，本地IPV6测试方法</a></li>
</ul>
<h3 id="二-解决办法"><a href="#二-解决办法" class="headerlink" title="二. 解决办法"></a>二. 解决办法</h3><p>总的来说有三个方面的问题:</p>
<ul>
<li>服务器不支持IPV6</li>
<li>项目中导入的第三方SDK不支持IPV6</li>
<li>项目中涉及到的网络请求不支持IPV6</li>
</ul>
<p>除了这些, 还有些其他因素, 比如苹果正在审核, 而你们的后台在部署接口, 这种才是真的坑爹😤啊, 不多说, 感觉眼泪止不住往下流了;</p>
<h4 id="1-服务器"><a href="#1-服务器" class="headerlink" title="1. 服务器"></a>1. 服务器</h4><p><strong>①检测服务器是否支持IPV6</strong><br>终端输入以下代码:(参照网上方法)</p>
<blockquote>
<p>dig +nocmd + nostats 你的域名 AAAA</p>
</blockquote>
<p>这是看看你们的服务器在IPV6下是否有回应。</p>
<p><img src="https://ooo.0o0.ooo/2017/06/30/5955ca4a92010.png" alt="简书的域名检测"><br>有错误的话, 对照下面的表:</p>
<p><img src="https://ooo.0o0.ooo/2017/06/30/5955cb2594ad3.jpeg" alt=""><br>改变DNS的配置，直到稳定返回 NOERROR 为止。</p>
<p><strong>②更改服务器配置</strong><br><a href="https://jiandanxinli.github.io/2016-08-06.html" target="_blank" rel="external">阿里云 Ubuntu 支持 IPv6 的完整步骤</a></p>
<h4 id="2-第三方SDK"><a href="#2-第三方SDK" class="headerlink" title="2. 第三方SDK"></a>2. 第三方SDK</h4><p>这些问题一般会出现在那些维护的APP里面, 由于是初次开发APP的人所处的时间相对较远, 所以项目里所用的SDK会有一些功能缺失; 下面介绍几个第三方SDK的问题;<br><strong>①Reachability</strong><br><img src="https://ooo.0o0.ooo/2017/06/30/5955ce07c06c1.png" alt=""><br>苹果都发话, 这个当然要改了;<br>新的sdk包将这个方法干掉了：reachabilityForLocalWiFi，只要自己的代码中干掉就行了，没什么影响。</p>
<p>原因如下介绍：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">#pragma mark reachabilityForLocalWiFi</div><div class="line"></div><div class="line">//reachabilityForLocalWiFi has been removed from the sample.  See ReadMe.md for more information.</div><div class="line"></div><div class="line">//+ (instancetype)reachabilityForLocalWiFi;</div></pre></td></tr></table></figure></p>
<p><strong>②JPush极光推送(v2.1.7开始支持)</strong><br>这个是我们项目里遇到的问题, SDK版本低了, 不支持IPV6;</p>
<p><img src="https://ooo.0o0.ooo/2017/06/30/5955df8f3b338.png" alt=""><br>从图中可以看出, 2.1.7版本才开始支持IPV6, 而我们版本是2.1.0; 唉😔, 乖乖升级咯;<br>附:<br><a href="https://docs.jiguang.cn/jpush/updates/" target="_blank" rel="external">极光文档地址</a></p>
<p><strong>③微博SDK(v3.1.4开始支持)</strong></p>
<p><img src="https://ooo.0o0.ooo/2017/06/30/5955e5ed3012a.png" alt=""><br>而且从官方文档上发现, 更新SDK, 实际上是更新Reachability库;</p>
<p><img src="https://ooo.0o0.ooo/2017/06/30/5955e6d83e8ae.png" alt=""><br>附:<br><a href="https://github.com/sinaweibosdk/weibo_ios_sdk/blob/master/%E5%BE%AE%E5%8D%9AiOS%E5%B9%B3%E5%8F%B0SDK%E6%96%87%E6%A1%A3V3.2.0.pdf" target="_blank" rel="external">微博SDK文档地址</a></p>
<p><strong>④友盟(v5.2.1开始支持)</strong></p>
<p><img src="https://ooo.0o0.ooo/2017/06/30/5955e8d368d67.png" alt=""><br>附:<br><a href="http://dev.umeng.com/social/ios/sdk-download" target="_blank" rel="external">友盟文档地址</a></p>
<p><strong>⑤微信(v1.5开始支持)</strong></p>
<p><img src="https://ooo.0o0.ooo/2017/06/30/5955e9bfbce6a.png" alt=""><br>有简友说微信的sdk包是支持ipv6的，但是微信本身并不支持ipv6，所以说，即便你替换了最新的sdk包，在ipv6网络下还是不能用微信分享，因为你的app应用在ipv6网络环境下调不起微信，也就分享不了了，这个问题微信应该意识到了，估计后边的版本应该也是支持ipv6, 这个大家可以注意下;<br>附:<br><a href="https://open.weixin.qq.com/cgi-bin/showdocument?action=dir_list&amp;t=resource/res_list&amp;verify=1&amp;id=open1419319164&amp;lang=zh_CN" target="_blank" rel="external">微信文档地址</a></p>
<p><strong>⑥QQ(未说明)</strong></p>
<p><img src="https://ooo.0o0.ooo/2017/06/30/5955eec23edc2.png" alt=""><br>从变更历史也看不出从哪个版本开始支持的, 估计是觉得这点玩意儿不值得说吧. 大佬们的世界真是看不懂, 大家就按时间来估计吧;<br>附:<br><a href="http://wiki.open.qq.com/wiki/IOS_API调用说明" target="_blank" rel="external">QQ文档地址</a></p>
<p><strong>⑦支付宝(未说明)</strong></p>
<p><img src="https://ooo.0o0.ooo/2017/06/30/5955f29a74491.png" alt=""><br>看下载的demo里面, 版本更新历史对具体哪个版本更新的未说明, 万一是最近被苹果打压的才更新的, 也不一定, 反正最新版本肯定是有了, 而且还多了些其他功能;<br>附:<br><a href="https://docs.open.alipay.com/54/104509/" target="_blank" rel="external">支付宝文档地址</a></p>
<p><strong>⑧百度地图(v3.0.0开始支持)</strong></p>
<p><img src="https://ooo.0o0.ooo/2017/06/30/5955f3ccad535.png" alt=""><br>附:<br><a href="http://lbsyun.baidu.com/index.php?title=iossdk/theupdatelog" target="_blank" rel="external">百度地图文档地址</a></p>
<p><strong>⑨环信(v3.1.3开始支持)</strong></p>
<p><img src="https://ooo.0o0.ooo/2017/06/30/5955f55396eff.png" alt=""><br>附:<br><a href="http://docs.easemob.com/im/300iosclientintegration/130iosqa" target="_blank" rel="external">环信文档地址</a></p>
<p><strong>⑩科大讯飞语音(v1.133开始支持)</strong></p>
<p><img src="https://ooo.0o0.ooo/2017/06/30/5955f883a146c.png" alt=""><br>附:<br><a href="http://www.xfyun.cn/sdk/dispatcher" target="_blank" rel="external">科大讯飞语音文档地址</a></p>
<p>当然还有很多其他的SDK, 这里就不一一列举了, 根据项目里用了哪些, 看下官方文档SDK版本历史比对一下就行;</p>
<h4 id="3-网络请求"><a href="#3-网络请求" class="headerlink" title="3. 网络请求"></a>3. 网络请求</h4><p>其实对于ipv6_Only的处理，从两大方面进行自己审核：自身网络请求和三方涉及网络请求, 毕竟是由于网络问题;<br>关于AFNetworking是否支持IPV6, 下面是一网友的说法:</p>
<p><img src="https://ooo.0o0.ooo/2017/06/30/5955f995570a4.png" alt=""></p>
<p>而版本支持是在3.0以后;</p>
<p><img src="https://ooo.0o0.ooo/2017/06/30/5955f9c5cecb7.png" alt=""></p>
<p>当然, 听说网友还遇到了其他的问题:(这个我没遇到, 不过还是在这里记一下😆)<br>内网的访问下是不可能连接到自己的服务器，后面测试一下公网阿里云的服务器，能够正常连接，这个可能是DNS64在搜索ipv6的过程中，并没有搜索内网的网络，导致内网连接失败;</p>
<p>如果这些还是没能解决你的问题, 可以看看下面这篇文章:<br><a href="http://www.jianshu.com/p/a6bab07c4062" target="_blank" rel="external">http://www.jianshu.com/p/a6bab07c4062</a></p>
<p>最后感谢参考文章作者的分享, 希望攻城狮们早日解决bug, 继续撸代码, O(∩_∩)O哈哈~</p>
<p>本文参考文章:<br><a href="http://www.jianshu.com/p/ba627e73e5b4" target="_blank" rel="external">iOS 被拒6次的ipv6</a><br><a href="http://www.jianshu.com/p/97b205933c15" target="_blank" rel="external">Ipv6_Only 简单的理解（已验证，项目已经上线）</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;自从去年6月1号Apple明文规定所有开发者提交新版本都必须支持IPV6-Only的网络，估计很多iOS开发者都遇到由于IPV6网络不支持造成的审核被拒的情况, 我被坑的不轻啊, 下面就来分析一下IPV6问题如何解决。&lt;/p&gt;
&lt;p&gt;首先附一个审核被拒的原文:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Guideline 2.1 - Performance - App Completeness&lt;br&gt;  We discovered one or more bugs in your app when reviewed on iPad running iOS 10.3.2 on Wi-Fi connected to an IPv6 network.&lt;br&gt;  Specifically, the app launched to a blank page.&lt;br&gt;  Please see attached screenshots for details.&lt;/p&gt;
&lt;p&gt;Next Steps&lt;br&gt;  To resolve this issue, please run your app on a device while connected to an IPv6 network (all apps must support IPv6) to identify any issues, then revise and resubmit your app for review.&lt;br&gt;  If we misunderstood the intended behavior of your app, please reply to this message in Resolution Center to provide information on how these features were intended to work.&lt;br&gt;  For new apps, uninstall all previous versions of your app from a device, then install and follow the steps to reproduce the issue. For updates, install the new version as an update to the previous version, then follow the steps to reproduce the issue.&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="iOS" scheme="https://binzi56.github.io/categories/iOS/"/>
    
    
      <category term="appStore" scheme="https://binzi56.github.io/tags/appStore/"/>
    
      <category term="iOS" scheme="https://binzi56.github.io/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>iOS网络请求错误整理</title>
    <link href="https://binzi56.github.io/2017/06/28/iOS-http-error-code/"/>
    <id>https://binzi56.github.io/2017/06/28/iOS-http-error-code/</id>
    <published>2017-06-28T08:41:10.000Z</published>
    <updated>2017-06-28T08:53:08.000Z</updated>
    
    <content type="html"><![CDATA[<p>在iOS开发中经常会遇到网络请求的错误, 一方面可能会是自己网络请求的方式, 参数, 请求头等造成的; 另一方面可能就是后台写的接口出了问题; 所以看懂报错原因就显得尤为重要.</p>
<h3 id="一-iOS错误状态码"><a href="#一-iOS错误状态码" class="headerlink" title="一. iOS错误状态码"></a>一. iOS错误状态码</h3><p>经常遇到的错误是400~500, 下面主要整理下它们各自的报错原因:</p>
<h4 id="HTTP-错误-400"><a href="#HTTP-错误-400" class="headerlink" title="HTTP 错误 400"></a>HTTP 错误 400</h4><p><strong>400 请求出错</strong><br>由于语法格式有误，服务器无法理解此请求。不作修改，客户程序就无法重复此请求。<br><a id="more"></a></p>
<h4 id="HTTP-错误-401"><a href="#HTTP-错误-401" class="headerlink" title="HTTP 错误 401"></a>HTTP 错误 401</h4><p><strong>401.1 未授权：登录失败</strong><br>此错误表明传输给服务器的证书与登录服务器所需的证书不匹配。<br>请与 Web 服务器的管理员联系，以确认您是否具有访问所请求资源的权限。<br><strong>401.2 未授权：服务器的配置导致登录失败</strong><br>此错误表明传输给服务器的证书与登录服务器所需的证书不匹配。此错误通常由未发送正确的 WWW 验证表头字段所致。<br>请与 Web 服务器的管理员联系，以确认您是否具有访问所请求资源的权限。<br><strong>401.3 未授权：由于资源中的 ACL 而未授权</strong><br>此错误表明客户所传输的证书没有对服务器中特定资源的访问权限。此资源可能是客户机中的地址行所列出的网页或文件，也可能是处理客户机中的地址行所列出的文件所需服务器上的其他文件。<br>请记录试图访问的完整地址，并与 Web 服务器的管理员联系以确认您是否具有访问所请求资源的权限。<br><strong>401.4 未授权：授权服务被筛选程序拒绝</strong><br>此错误表明 Web 服务器已经安装了筛选程序，用以验证连接到服务器的用户。此筛选程序拒绝连接到此服务器的真品证书的访问。<br>请记录试图访问的完整地址，并与 Web 服务器的管理员联系以确认您是否具有访问所请求资源的权限。<br><strong>401.5 未授权：ISAPI/CGI 应用程序的授权失败</strong><br>此错误表明试图使用的 Web服务器中的地址已经安装了 ISAPI 或 CGI程序，在继续之前用以验证用户的证书。此程序拒绝用来连接到服务器的真品证书的访问。<br>请记录试图访问的完整地址，并与 Web服务器的管理员联系以确认您是否具有访问所请求资源的权限</p>
<h4 id="HTTP-错误-403"><a href="#HTTP-错误-403" class="headerlink" title="HTTP 错误 403"></a>HTTP 错误 403</h4><p><strong>403.1 禁止：禁止执行访问</strong><br>如果从并不允许执行程序的目录中执行 CGI、ISAPI或其他执行程序就可能引起此错误。<br>如果问题依然存在，请与 Web 服务器的管理员联系。<br><strong>403.2 禁止：禁止读取访问</strong><br>如果没有可用的默认网页或未启用此目录的目录浏览，或者试图显示驻留在只标记为执行或脚本权限的目录中的HTML 页时就会导致此错误。<br>如果问题依然存在，请与 Web 服务器的管理员联系。<br><strong>403.3 禁止：禁止写访问</strong><br>如果试图上载或修改不允许写访问的目录中的文件，就会导致此问题。<br>如果问题依然存在，请与 Web服务器的管理员联系。<br><strong>403.4 禁止：需要 SSL</strong><br>此错误表明试图访问的网页受安全套接字层（SSL）的保护。要查看，必须在试图访问的地址前输入https:// 以启用 SSL。<br>如果问题依然存在，请与 Web服务器的管理员联系。<br><strong>403.5 禁止：需要 SSL 128</strong><br>此错误消息表明您试图访问的资源受 128位的安全套接字层（SSL）保护。要查看此资源，需要有支持此SSL 层的浏览器。<br>请确认浏览器是否支持 128 位 SSL安全性。如果支持，就与 Web服务器的管理员联系，并报告问题。<br><strong>403.6 禁止：拒绝 IP 地址</strong><br>如果服务器含有不允许访问此站点的 IP地址列表，并且您正使用的 IP地址在此列表中，就会导致此问题。<br>如果问题依然存在，请与 Web服务器的管理员联系。<br><strong>403.7 禁止：需要用户证书</strong><br>当试图访问的资源要求浏览器具有服务器可识别的用户安全套接字层（SSL）证书时就会导致此问题。可用来验证您是否为此资源的合法用户。<br>请与 Web服务器的管理员联系以获取有效的用户证书。<br><strong>403.8 禁止：禁止站点访问</strong><br>如果 Web服务器不为请求提供服务，或您没有连接到此站点的权限时，就会导致此问题。<br>请与 Web 服务器的管理员联系。<br><strong>403.9 禁止访问：所连接的用户太多</strong><br>如果 Web太忙并且由于流量过大而无法处理您的请求时就会导致此问题。请稍后再次连接。<br>如果问题依然存在，请与 Web 服务器的管理员联系。<br><strong>403.10 禁止访问：配置无效</strong><br>此时 Web 服务器的配置存在问题。<br>如果问题依然存在，请与 Web服务器的管理员联系。<br><strong>403.11 禁止访问：密码已更改</strong><br>在身份验证的过程中如果用户输入错误的密码，就会导致此错误。请刷新网页并重试。<br>如果问题依然存在，请与 Web服务器的管理员联系。<br><strong>403.12 禁止访问：映射程序拒绝访问</strong><br>拒绝用户证书试图访问此 Web 站点。<br>请与站点管理员联系以建立用户证书权限。如果必要，也可以更改用户证书并重试。</p>
<h4 id="HTTP-错误-404"><a href="#HTTP-错误-404" class="headerlink" title="HTTP 错误 404"></a>HTTP 错误 404</h4><p><strong>404 找不到</strong><br>Web 服务器找不到您所请求的文件或脚本。请检查URL 以确保路径正确。<br>如果问题依然存在，请与服务器的管理员联系。</p>
<h4 id="HTTP-错误-405"><a href="#HTTP-错误-405" class="headerlink" title="HTTP 错误 405"></a>HTTP 错误 405</h4><p><strong>405 不允许此方法</strong><br>对于请求所标识的资源，不允许使用请求行中所指定的方法。请确保为所请求的资源设置了正确的 MIME 类型。<br>如果问题依然存在，请与服务器的管理员联系。</p>
<h4 id="HTTP-错误-406"><a href="#HTTP-错误-406" class="headerlink" title="HTTP 错误 406"></a>HTTP 错误 406</h4><p><strong>406 不可接受</strong><br>根据此请求中所发送的“接受”标题，此请求所标识的资源只能生成内容特征为“不可接受”的响应实体。<br>如果问题依然存在，请与服务器的管理员联系。</p>
<h4 id="HTTP-错误-407"><a href="#HTTP-错误-407" class="headerlink" title="HTTP 错误 407"></a>HTTP 错误 407</h4><p><strong>407 需要代理身份验证 </strong><br>在可为此请求提供服务之前，您必须验证此代理服务器。请登录到代理服务器，然后重试。<br>如果问题依然存在，请与 Web 服务器的管理员联系。</p>
<h4 id="HTTP-错误-412"><a href="#HTTP-错误-412" class="headerlink" title="HTTP 错误 412"></a>HTTP 错误 412</h4><p><strong>412 前提条件失败</strong><br>在服务器上测试前提条件时，部分请求标题字段中所给定的前提条件估计为FALSE。客户机将前提条件放置在当前资源 metainformation（标题字段数据）中，以防止所请求的方法被误用到其他资源。<br>如果问题依然存在，请与 Web 服务器的管理员联系。</p>
<h4 id="HTTP-错误-414"><a href="#HTTP-错误-414" class="headerlink" title="HTTP 错误 414"></a>HTTP 错误 414</h4><p><strong>414 Request-URI 太长 </strong><br>Request-URL太长，服务器拒绝服务此请求。仅在下列条件下才有可能发生此条件：<br>客户机错误地将 POST 请求转换为具有较长的查询信息的 GET 请求。<br>客户机遇到了重定向问题（例如，指向自身的后缀的重定向前缀）。<br>服务器正遭受试图利用某些服务器（将固定长度的缓冲区用于读取或执行 Request-URI）中的安全性漏洞的客户干扰。<br>如果问题依然存在，请与 Web 服务器的管理员联系。</p>
<h4 id="HTTP-错误-500"><a href="#HTTP-错误-500" class="headerlink" title="HTTP 错误 500"></a>HTTP 错误 500</h4><p><strong>500 服务器的内部错误</strong><br>Web 服务器不能执行此请求。请稍后重试此请求。<br>如果问题依然存在，请与 Web服务器的管理员联系。</p>
<h4 id="HTTP-错误-501"><a href="#HTTP-错误-501" class="headerlink" title="HTTP 错误 501"></a>HTTP 错误 501</h4><p><strong>501 未实现</strong><br>Web 服务器不支持实现此请求所需的功能。请检查URL 中的错误，如果问题依然存在，请与 Web服务器的管理员联系。</p>
<h4 id="HTTP-错误-502"><a href="#HTTP-错误-502" class="headerlink" title="HTTP 错误 502"></a>HTTP 错误 502</h4><p><strong>502 网关出错</strong><br>当用作网关或代理时，服务器将从试图实现此请求时所访问的upstream 服务器中接收无效的响应。<br>如果问题依然存在，请与 Web服务器的管理员联系。</p>
<p>附:<br><a href="http://blog.csdn.net/qqqqzxg/article/details/50715332" target="_blank" rel="external">iOS网络请求的错误状态码</a><br><a href="https://en.wikipedia.org/wiki/List_of_HTTP_status_codes" target="_blank" rel="external">维基百科 List of HTTP status codes</a></p>
<h3 id="二-特殊的错误处理"><a href="#二-特殊的错误处理" class="headerlink" title="二. 特殊的错误处理"></a>二. 特殊的错误处理</h3><blockquote>
<p>证书无效问题:NSURLSession/NSURLConnection HTTP load failed (kCFStreamErrorDomainSSL, -9843)</p>
</blockquote>
<p>当前服务器的证书无效, 网上也有很多其他的处理方式, 我选择的是下方这种, 附上代码:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"> @implementation NSURLRequest (NSURLRequestWithIgnoreSSL)</div><div class="line"> + (BOOL)allowsAnyHTTPSCertificateForHost:(NSString *)host</div><div class="line">&#123;</div><div class="line">     return YES;</div><div class="line"> &#125;</div><div class="line">@end</div></pre></td></tr></table></figure></p>
<p>把这个段代码 写到NSURLRequest分类中, 作用是 绕过SSL证书验证, 直接访问; 当然这样的做法不安全, 一般都不会这样做, 只是为了测试接口是否可用, 最好还是服务器添加证书;<br>附:<br><a href="http://blog.csdn.net/github_34613936/article/details/51490032" target="_blank" rel="external">https信任证书的三种方式</a></p>
<p>希望看到此文的朋友们能够积极补充, 共同维护这篇文章, 多谢(<em>^__^</em>) 嘻嘻……</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;在iOS开发中经常会遇到网络请求的错误, 一方面可能会是自己网络请求的方式, 参数, 请求头等造成的; 另一方面可能就是后台写的接口出了问题; 所以看懂报错原因就显得尤为重要.&lt;/p&gt;
&lt;h3 id=&quot;一-iOS错误状态码&quot;&gt;&lt;a href=&quot;#一-iOS错误状态码&quot; class=&quot;headerlink&quot; title=&quot;一. iOS错误状态码&quot;&gt;&lt;/a&gt;一. iOS错误状态码&lt;/h3&gt;&lt;p&gt;经常遇到的错误是400~500, 下面主要整理下它们各自的报错原因:&lt;/p&gt;
&lt;h4 id=&quot;HTTP-错误-400&quot;&gt;&lt;a href=&quot;#HTTP-错误-400&quot; class=&quot;headerlink&quot; title=&quot;HTTP 错误 400&quot;&gt;&lt;/a&gt;HTTP 错误 400&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;400 请求出错&lt;/strong&gt;&lt;br&gt;由于语法格式有误，服务器无法理解此请求。不作修改，客户程序就无法重复此请求。&lt;br&gt;
    
    </summary>
    
      <category term="iOS" scheme="https://binzi56.github.io/categories/iOS/"/>
    
    
      <category term="iOS" scheme="https://binzi56.github.io/tags/iOS/"/>
    
      <category term="网络请求" scheme="https://binzi56.github.io/tags/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/"/>
    
  </entry>
  
  <entry>
    <title>上传苹果商店时一个不太平常的error</title>
    <link href="https://binzi56.github.io/2017/06/23/appStore-upload-error/"/>
    <id>https://binzi56.github.io/2017/06/23/appStore-upload-error/</id>
    <published>2017-06-23T03:20:54.000Z</published>
    <updated>2017-06-23T08:48:31.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>This action could not be completed. Try again. (-22421)</p>
</blockquote>
<p>报错如图所示:<br><img src="http://upload-images.jianshu.io/upload_images/1893416-85e459204bdd5bc4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="-22421上传appStore错误.png"></p>
<p>以前一直以为像这种错误只可能是网络问题, 最近升级了xcode, 出现这个问题, 解决两天才弄出来. 想来也最怕这种定位不到的问题, 网上众说纷纭, 最后在苹果的官方论坛里找到这个解决办法, 下面几十个点赞, 看来出问题的不止我一个, 也谢谢他们的分享, 哈哈;<br><a id="more"></a><br>解决办法如下, 在终端按照步骤依次输入code:<br>step1:</p>
<blockquote>
<p>cd ~  </p>
</blockquote>
<p>step2:</p>
<blockquote>
<p>mv .itmstransporter/ .old_itmstransporter/  </p>
</blockquote>
<p>step3:</p>
<blockquote>
<p>“/Applications/Xcode.app/Contents/Applications/Application Loader.app/Contents/itms/bin/iTMSTransporter”</p>
</blockquote>
<p>之后再次提交应该可以了, 希望能帮助到大家;</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;This action could not be completed. Try again. (-22421)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;报错如图所示:&lt;br&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1893416-85e459204bdd5bc4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;-22421上传appStore错误.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;以前一直以为像这种错误只可能是网络问题, 最近升级了xcode, 出现这个问题, 解决两天才弄出来. 想来也最怕这种定位不到的问题, 网上众说纷纭, 最后在苹果的官方论坛里找到这个解决办法, 下面几十个点赞, 看来出问题的不止我一个, 也谢谢他们的分享, 哈哈;&lt;br&gt;
    
    </summary>
    
      <category term="iOS" scheme="https://binzi56.github.io/categories/iOS/"/>
    
    
      <category term="appStore" scheme="https://binzi56.github.io/tags/appStore/"/>
    
      <category term="iOS" scheme="https://binzi56.github.io/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>cordova插件用法详述(内含demo)</title>
    <link href="https://binzi56.github.io/2017/06/23/plugin-method-of-use/"/>
    <id>https://binzi56.github.io/2017/06/23/plugin-method-of-use/</id>
    <published>2017-06-23T03:13:37.000Z</published>
    <updated>2017-06-23T03:33:19.000Z</updated>
    
    <content type="html"><![CDATA[<p>一. 导入插件用法(以cordova-plugin-appversion为例)<br>1.导入方法:<br>添加插件;</p>
<blockquote>
<p>cordova plugin add cordova-plugin-appversion</p>
</blockquote>
<p>2.文件概述:<br>导入的文件, 系统已自动配置好了一切需要配置的文件, 所以直接调用就OK了;<br>js:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">document</span>.addEventListener(<span class="string">"deviceready"</span>, onDeviceReady, <span class="literal">false</span>);</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">onDeviceReady</span>(<span class="params"></span>)</span>&#123;</div><div class="line">       <span class="comment">// 设置App的版本号</span></div><div class="line">       $scope.version = AppVersion.version;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<a id="more"></a>
<p>h5:<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></div><div class="line">   当前myFirstProject的版本为&#123;&#123;version&#125;&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>效果图:(包含了该插件的其他方法, 具体参见demo)</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1893416-0a34f6839beed93c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="导入插件用法.png"><br>注意:<br>       一般的插件，可以直接调用; 但是这种涉及到硬件或者系统的插件，就需要加上这个监听事件;<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 监听事件</span></div><div class="line"><span class="built_in">document</span>.addEventListener(<span class="string">"deviceready"</span>, onDeviceReady, <span class="literal">false</span>);</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">onDeviceReady</span>(<span class="params"></span>)</span>&#123;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>附:<br><a href="https://www.npmjs.com/package/cordova-plugin-appversion" target="_blank" rel="external">cordova-plugin-appversion插件官方解释</a><br><a href="http://www.hangge.com/blog/cache/detail_1158.html" target="_blank" rel="external">Cordova - 常用的插件与终端插件命令汇总</a></p>
<p>二.自定义插件用法<br>1.创建自定义插件<br>插件目录如下:</p>
<blockquote>
<p>|MyMath<br>—-|src<br>———|android<br>————–MyMath.java<br>———|ios<br>————–MyMath.m<br>—-|www<br>———|MyMath.js<br>—-plugin.xml</p>
</blockquote>
<p>注意:<br> 创建插件可以自己按照插件目录创建, 这样plugin.xml文件中太繁琐; 本文推荐用plugman创建插件, 既方便又不容易出错;<br>附:<br><a href="http://blog.csdn.net/b2259909/article/details/52471178?locationNum=2" target="_blank" rel="external"><a href="http://blog.csdn.net/b2259909/article/details/52471178" target="_blank" rel="external">使用plugman 创建一个自己的cordova插件</a></a></p>
<p>2.导入自定义插件<br>按照链接创建好插件后, 就开始导入插件了; 这里我被坑的不浅啊, 看网上把插件放在plugins文件下, 然后update platforms; 可是完全不起作用, 还一顿报错; 原来此处就一句代码解决了;<br>下方为终端输入:</p>
<blockquote>
<p>cordova plugin add /Users/apple/Desktop/test1</p>
</blockquote>
<p>该方法添加插件后, 相应的config.xml, cordova_plugins.js, plugins会自动配置, 无需像手动导入的那么繁琐, 还容易出错;</p>
<p>3.使用说明<br>demo给plugman创建的插件重新写入了方法, 具体实现看demo, 下方附上效果图;</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1893416-0d5d18bb372b58c5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="自定义插件用法.png"></p>
<p><a href="https://github.com/binzi56/test1.git" target="_blank" rel="external">点击下载demo</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;一. 导入插件用法(以cordova-plugin-appversion为例)&lt;br&gt;1.导入方法:&lt;br&gt;添加插件;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;cordova plugin add cordova-plugin-appversion&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;2.文件概述:&lt;br&gt;导入的文件, 系统已自动配置好了一切需要配置的文件, 所以直接调用就OK了;&lt;br&gt;js:&lt;br&gt;&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;document&lt;/span&gt;.addEventListener(&lt;span class=&quot;string&quot;&gt;&quot;deviceready&quot;&lt;/span&gt;, onDeviceReady, &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onDeviceReady&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;)&lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       &lt;span class=&quot;comment&quot;&gt;// 设置App的版本号&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       $scope.version = AppVersion.version;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="ionic" scheme="https://binzi56.github.io/categories/ionic/"/>
    
    
      <category term="ionic" scheme="https://binzi56.github.io/tags/ionic/"/>
    
      <category term="plugin" scheme="https://binzi56.github.io/tags/plugin/"/>
    
  </entry>
  
  <entry>
    <title>自制cordova逆地理编码插件(OC)</title>
    <link href="https://binzi56.github.io/2017/06/23/cordova-plugin-geolocation/"/>
    <id>https://binzi56.github.io/2017/06/23/cordova-plugin-geolocation/</id>
    <published>2017-06-23T03:02:52.000Z</published>
    <updated>2017-07-04T06:39:17.000Z</updated>
    
    <content type="html"><![CDATA[<p>本文主要介绍iOS的逆地理定位插件,  用过官方的cordova-plugin-geolocation插件的都清楚, 该插件虽然得到了经纬度, 但是没法转换成我们想要位置信息, 于是就需要一个插件将经纬度转化为位置信息, 即逆地理编码;<br>1.插件介绍<br>该插件是用OC做的一个经纬度转换为位置的插件; OC内部通过CLGeocoder的方法实现逆地理编码;由于需要调用系统硬件, 所以该插件直到deviceready事件发生后才可用;<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">document</span>.addEventListener(<span class="string">"deviceready"</span>, onDeviceReady, <span class="literal">false</span>);</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">onDeviceReady</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"deviceready"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<a id="more"></a>
<p>2.自定义插件的添加<br>下载好插件后, 直接添加本地目录即可;(插件最下方附上链接地址)</p>
<blockquote>
<p>cordova plugin add  /Users/apple/Desktop/cordova-plugin-reverseGeocoding</p>
</blockquote>
<p>3.用法实例<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">document</span>.addEventListener(<span class="string">"deviceready"</span>, onDeviceReady, <span class="literal">false</span>);</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">onDeviceReady</span>(<span class="params"></span>) </span>&#123;</div><div class="line">     <span class="function"><span class="keyword">function</span> <span class="title">success</span>(<span class="params">message</span>)</span>&#123;</div><div class="line">           alert(<span class="string">"定位成功:"</span> + message);</div><div class="line">           &#125;;</div><div class="line"></div><div class="line">           <span class="function"><span class="keyword">function</span> <span class="title">error</span>(<span class="params">message</span>)</span>&#123;</div><div class="line">           alert(<span class="string">"定位失败:"</span> + message);</div><div class="line">           &#125;;</div><div class="line">           cordova.plugins.reverseGeocoding.address([<span class="number">24.840882</span>, <span class="number">102.843752</span>], success, error);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>4.使用说明<br>返回的message是一个对象, 对象的结构如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">// &#123;</div><div class="line">//     City = &quot;昆明市&quot;;</div><div class="line">//     Country = &quot;中国&quot;;</div><div class="line">//     CountryCode = CN;</div><div class="line">//     FormattedAddressLines =     (</div><div class="line">//         &quot;中国云南省昆明市呈贡区吴家营街道仕林街&quot;</div><div class="line">//     );</div><div class="line">//     Name = &quot;仕林街&quot;;</div><div class="line">//     State = &quot;云南省&quot;;</div><div class="line">//     Street = &quot;仕林街&quot;;</div><div class="line">//     SubLocality = &quot;呈贡区&quot;;</div><div class="line">//     Thoroughfare = &quot;仕林街&quot;;</div><div class="line">// &#125;</div></pre></td></tr></table></figure></p>
<p>5.要点介绍<br>由于系统默认的语言是英文, 有些工程返回的数据信息是英文;之前试过更改NSUserDefaults里面的AppleLanguages, 去改变系统语言, 但是估计系统做了缓存处理, 所以程序重启后才生效.  最后用了一种简便的方法来实现切换语言, 如下图所示;<br>(1)首先打开工程的edit scheme;<br><img src="http://upload-images.jianshu.io/upload_images/1893416-5d33d29e9c1850f6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="屏幕快照 2017-03-27 上午9.37.45.png"><br>(2)在run-options-application language中选择中文简体;</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1893416-039a6f17e6c3fa99.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="屏幕快照 2017-03-27 上午9.38.09.png"><br>(3)如果(2)中可以选择中文简体则不用执行这步;<br>有的工程里面没有其他语言;则可在Localizations中添加;<br><img src="http://upload-images.jianshu.io/upload_images/1893416-6ba19405be8da24f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="屏幕快照 2017-03-27 上午9.48.44.png"><br>注:<br>如果(3)还不可以选择中文的话, 可以新建一个OC工程(不是ionic工程哦, 用Xcode打开一个工程, 然后command+shift+n新建一个), 执行(3)中添加中文简体, 然后将最外面的zh-Hans.lproj文件夹copy到你的工程里面最外面的文件夹, 之后问题解决;值得注意的是, 执行了(3)后的添加localizations, 还得执行(2)中的切换系统语言;</p>
<p>附:<br><a href="https://github.com/binzi56/cordova-plugin-reverseGeocoding.git" target="_blank" rel="external">插件下载地址</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本文主要介绍iOS的逆地理定位插件,  用过官方的cordova-plugin-geolocation插件的都清楚, 该插件虽然得到了经纬度, 但是没法转换成我们想要位置信息, 于是就需要一个插件将经纬度转化为位置信息, 即逆地理编码;&lt;br&gt;1.插件介绍&lt;br&gt;该插件是用OC做的一个经纬度转换为位置的插件; OC内部通过CLGeocoder的方法实现逆地理编码;由于需要调用系统硬件, 所以该插件直到deviceready事件发生后才可用;&lt;br&gt;&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;document&lt;/span&gt;.addEventListener(&lt;span class=&quot;string&quot;&gt;&quot;deviceready&quot;&lt;/span&gt;, onDeviceReady, &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onDeviceReady&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(&lt;span class=&quot;string&quot;&gt;&quot;deviceready&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="ionic" scheme="https://binzi56.github.io/categories/ionic/"/>
    
    
      <category term="ionic" scheme="https://binzi56.github.io/tags/ionic/"/>
    
      <category term="objective-c" scheme="https://binzi56.github.io/tags/objective-c/"/>
    
      <category term="plugin" scheme="https://binzi56.github.io/tags/plugin/"/>
    
  </entry>
  
  <entry>
    <title>ionic优秀资源整理</title>
    <link href="https://binzi56.github.io/2017/06/23/ionic-article/"/>
    <id>https://binzi56.github.io/2017/06/23/ionic-article/</id>
    <published>2017-06-23T02:53:57.000Z</published>
    <updated>2017-06-23T08:56:16.000Z</updated>
    
    <content type="html"><![CDATA[<p>网上关于ionic的资源比较少, 好多刚入门的开发者找不到入门指导资源, 下面就推荐一些个人觉得比较好的资源;</p>
<p>一. 入门级指导<br>官方文档, 这个当然必不可少<br><a href="https://ionicframework.com/docs/" target="_blank" rel="external">https://ionicframework.com/docs/</a></p>
<p>中文版的ionic文档，给英文不好的朋友<br> <a href="http://www.ionic.wang/js_doc-index.html" target="_blank" rel="external">http://www.ionic.wang/js_doc-index.html</a></p>
<p>ionic菜鸟教程, 里面有许多基础知识<br><a href="http://www.runoob.com/ionic/ionic-install.html" target="_blank" rel="external">http://www.runoob.com/ionic/ionic-install.html</a><br><a id="more"></a><br>ionic2文档整理, 里面包含了所有控件的用法整理,很实用<br><a href="http://rainey.space/2016/04/06/Ionic2_Chinese_Document/" target="_blank" rel="external">http://rainey.space/2016/04/06/Ionic2_Chinese_Document/</a></p>
<p>小虎Oni的博客, 里面算是一些进阶的内容(包括按需加载controller, 一些性能优化等等)<br><a href="http://blog.csdn.net/onil_chen/article/category/6113346/2" target="_blank" rel="external">http://blog.csdn.net/onil_chen/article/category/6113346/2</a></p>
<p>二.解决一些问题<br>cnodejs社区ionic，可以学习一下<br><a href="https://cnodejs.org/topic/545aee5a3e1f39344c5b3b3e" target="_blank" rel="external">https://cnodejs.org/topic/545aee5a3e1f39344c5b3b3e</a></p>
<p>皓眸IT的博客，有许多ionic的知识，挺有价值的<a href="http://haomou.Net/2014/10/06/2014_ionic_learn/" target="_blank" rel="external">http://haomou.Net/2014/10/06/2014_ionic_learn/</a></p>
<p>ionic国内社区，可以互相学习下<br><a href="http://ionichina.com/" target="_blank" rel="external">http://ionichina.com/</a></p>
<p>三. 插件学习<br>cordova插件用法详述(内含demo), 这个是我之前写的, 入门级的demo, 可以看看简单插件怎么写, OC与js的交互是怎样的<br><a href="http://www.jianshu.com/p/138568e87e7e" target="_blank" rel="external">http://www.jianshu.com/p/138568e87e7e</a></p>
<p>cordova插件学习，对用ionic做开发会有帮助的<br><a href="http://rensanning.iteye.com/blog/2163892" target="_blank" rel="external">http://rensanning.iteye.com/blog/2163892</a></p>
<p>四. 一些demo合集<br>一些ionic的简单例子，从这些简单代码可以学到很多知识和理念  <a href="http://codepen.io/ionic/public-list/" target="_blank" rel="external">http://codepen.io/ionic/public-list/</a></p>
<p>Ionic系列——CodePen上的优秀Ionic_Demo<br><a href="https://my.oschina.net/u/1416844/blog/514361?fromerr=bbFC5JIl" target="_blank" rel="external">https://my.oschina.net/u/1416844/blog/514361?fromerr=bbFC5JIl</a></p>
<p>ionic扩展插件, 包括:时间选择; 日期选择; 省市县三级联动等;<br><a href="http://www.cnblogs.com/luckyuns/p/6168715.html" target="_blank" rel="external">http://www.cnblogs.com/luckyuns/p/6168715.html</a></p>
<p>五.爬坑指南(一些问题的解决办法)<br>1.新建的工程一般写在外面的www文件中, build后会自动同步到staging文件夹下的www文件中;添加插件会自动build;</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1893416-d07abd750a56720f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="屏幕快照 2017-03-13 下午2.31.04.png"></p>
<p>2.cordova没有跨域问题<br><img src="http://upload-images.jianshu.io/upload_images/1893416-fa60330810a1263a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="屏幕快照 2017-03-28 下午4.41.56.png"><br>开发的时候遇到这个问题, 试了网上许多跨域的方法都没用;<br>解决方案:(config.xml中修改)<br><img src="http://upload-images.jianshu.io/upload_images/1893416-b3f6c206cdca3f22.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="BEEEF561E73FD4C16CF33EA81BFC2AEF.jpg"><br>如果是浏览器，启动浏览器时带上参数 –disable-web-security “C:\Program Files (x86)\Google\Chrome\Application\chrome.exe” –user-data-dir=”” –disable-web-security</p>
<p>附:<br>Ionic常见问题及解决方案<br><a href="http://blog.csdn.net/molong421/article/details/51587853" target="_blank" rel="external">http://blog.csdn.net/molong421/article/details/51587853</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;网上关于ionic的资源比较少, 好多刚入门的开发者找不到入门指导资源, 下面就推荐一些个人觉得比较好的资源;&lt;/p&gt;
&lt;p&gt;一. 入门级指导&lt;br&gt;官方文档, 这个当然必不可少&lt;br&gt;&lt;a href=&quot;https://ionicframework.com/docs/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://ionicframework.com/docs/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;中文版的ionic文档，给英文不好的朋友&lt;br&gt; &lt;a href=&quot;http://www.ionic.wang/js_doc-index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.ionic.wang/js_doc-index.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ionic菜鸟教程, 里面有许多基础知识&lt;br&gt;&lt;a href=&quot;http://www.runoob.com/ionic/ionic-install.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.runoob.com/ionic/ionic-install.html&lt;/a&gt;&lt;br&gt;
    
    </summary>
    
      <category term="ionic" scheme="https://binzi56.github.io/categories/ionic/"/>
    
    
      <category term="ionic" scheme="https://binzi56.github.io/tags/ionic/"/>
    
      <category term="resources" scheme="https://binzi56.github.io/tags/resources/"/>
    
  </entry>
  
  <entry>
    <title>iOS处理单双击手势冲突问题</title>
    <link href="https://binzi56.github.io/2017/06/22/ios-article/"/>
    <id>https://binzi56.github.io/2017/06/22/ios-article/</id>
    <published>2017-06-22T08:57:51.000Z</published>
    <updated>2017-06-23T03:04:01.000Z</updated>
    
    <content type="html"><![CDATA[<p>这个是之前开发中遇到的一个问题. 当一个视图同时响应单双击手势, 而实际上需要它只响应一个手势就行; 这种情况当手势同时加在一个视图上或者两个视图的关系为父子级时出现, 下面就来介绍一下处理的方法;<br>这里展示一个demo:<br>如图所示, 在storyboard中拖入两个view, 分别为bigView和smallView, smallView为bigView的子视图;</p>
<p><img src="https://ooo.0o0.ooo/2017/06/22/594b8b9fda051.png" alt=""><br>接下来给这两个视图拖入属性后, 给smallView加上单击事件, bigView加上双击事件;<br><a id="more"></a><br>代码如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">#import &quot;ViewController.h&quot;</div><div class="line"></div><div class="line">@interface ViewController ()</div><div class="line">@property (weak, nonatomic) IBOutlet UIView *bigView;</div><div class="line">@property (weak, nonatomic) IBOutlet UIView *smallView;</div><div class="line">@end</div><div class="line"></div><div class="line">@implementation ViewController</div><div class="line"></div><div class="line">- (void)viewDidLoad</div><div class="line">&#123;</div><div class="line">    [super viewDidLoad];</div><div class="line"></div><div class="line">   UITapGestureRecognizer *singleTapGestureRecognizer = [[UITapGestureRecognizer alloc]initWithTarget:self action:@selector(singleTap:)];</div><div class="line"></div><div class="line">   [singleTapGestureRecognizer setNumberOfTapsRequired:1];</div><div class="line">   [_smallView addGestureRecognizer:singleTapGestureRecognizer];</div><div class="line"></div><div class="line">   UITapGestureRecognizer *doubleTapGestureRecognizer = [[UITapGestureRecognizer alloc]initWithTarget:self action:@selector(doubleTap:)];</div><div class="line">   [doubleTapGestureRecognizer setNumberOfTapsRequired:2];</div><div class="line">   [_bigView addGestureRecognizer:doubleTapGestureRecognizer];</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)singleTap:(UIGestureRecognizer*)gestureRecognizer</div><div class="line">&#123;</div><div class="line">   NSLog(@&quot;-----singleTap-----&quot;);</div><div class="line">   [_smallView setBackgroundColor:[UIColor yellowColor]];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)doubleTap:(UIGestureRecognizer*)gestureRecognizer</div><div class="line">&#123;</div><div class="line">   NSLog(@&quot;-----doubleTap-----&quot;);</div><div class="line">   [_bigView setBackgroundColor:[UIColor redColor]];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>接下来如果双击smallView, 你会发现视图变成下面这样:</p>
<p><img src="https://ooo.0o0.ooo/2017/06/22/594b9063a315f.png" alt=""><br>本来双击只加载在smallView的父视图bigView上, 结果smallView也响应了, 这就尴尬了😓了;<br>处理方式其实挺简单, 只不过最开始找了好久;<br>下面贴出代码:(在viewDidLoad方法末尾添加)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//这行很关键，意思是只有当没有检测到doubleTapGestureRecognizer或者检测doubleTapGestureRecognizer失败，singleTapGestureRecognizer才有效</div><div class="line">    [singleTapGestureRecognizer requireGestureRecognizerToFail:doubleTapGestureRecognizer];</div></pre></td></tr></table></figure></p>
<p>好了, 完美解决(<em>^__^</em>) 嘻嘻……</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;这个是之前开发中遇到的一个问题. 当一个视图同时响应单双击手势, 而实际上需要它只响应一个手势就行; 这种情况当手势同时加在一个视图上或者两个视图的关系为父子级时出现, 下面就来介绍一下处理的方法;&lt;br&gt;这里展示一个demo:&lt;br&gt;如图所示, 在storyboard中拖入两个view, 分别为bigView和smallView, smallView为bigView的子视图;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://ooo.0o0.ooo/2017/06/22/594b8b9fda051.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;接下来给这两个视图拖入属性后, 给smallView加上单击事件, bigView加上双击事件;&lt;br&gt;
    
    </summary>
    
      <category term="iOS" scheme="https://binzi56.github.io/categories/iOS/"/>
    
    
      <category term="iOS" scheme="https://binzi56.github.io/tags/iOS/"/>
    
      <category term="objective-c" scheme="https://binzi56.github.io/tags/objective-c/"/>
    
  </entry>
  
  <entry>
    <title>js处理手势冲突之冒泡用法</title>
    <link href="https://binzi56.github.io/2017/06/22/js-article/"/>
    <id>https://binzi56.github.io/2017/06/22/js-article/</id>
    <published>2017-06-22T04:07:01.000Z</published>
    <updated>2017-06-23T03:24:54.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://ooo.0o0.ooo/2017/06/22/594b8239c64d5.jpeg" alt=""><br>​    嵌套的div元素，如果父级和子元素都绑定了一些事件，那么在点击最内层子元素时可能会触发父级元素的事件，下面介绍一下js阻止默认事件与js阻止事件冒泡示例.</p>
<h4 id="一-event-preventDefault"><a href="#一-event-preventDefault" class="headerlink" title="一.event.preventDefault()"></a>一.event.preventDefault()</h4><p>​    阻止元素的默认事件。如:a元素的点击跳转的默认事件 ，button，radio等表单元素的默认事件 ，div 元素没有默认事件;<br>例:<br>   下方为html代码:<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">link</span>=<span class="string">"https://www.baidu.com"</span>&gt;</span>百度<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div></pre></td></tr></table></figure></p>
<a id="more"></a>
<p>​    具体处理方式如下:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</div><div class="line">  $(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  $(<span class="string">"a"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</div><div class="line">​     event.preventDefault();</div><div class="line">​   &#125;);</div><div class="line">&#125;);</div><div class="line"><span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></div></pre></td></tr></table></figure></p>
<p>参考链接:<br><a href="http://www.w3school.com.cn/jquery/event_preventdefault.asp" target="_blank" rel="external">jQuery 事件 - preventDefault() 方法</a></p>
<h4 id="二-event-stopPropagation"><a href="#二-event-stopPropagation" class="headerlink" title="二.event.stopPropagation()"></a>二.event.stopPropagation()</h4><p>​    该方法将停止事件的传播，阻止它被分派到其他 Document 节点。在事件传播的任何阶段都可以调用它。注意，虽然该方法不能阻止同一个 Document 节点上的其他事件句柄被调用，但是它可以阻止把事件分派到其他节点。<br>例:<br>​    下方为html代码:<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"> <span class="tag">&lt;<span class="name">div</span> <span class="attr">click</span>=<span class="string">"outsideDivAction()"</span> <span class="attr">style</span>=<span class="string">"background:blue;"</span>&gt;</span></div><div class="line">​    <span class="tag">&lt;<span class="name">div</span> <span class="attr">click</span>=<span class="string">"insideDivAction()"</span> <span class="attr">style</span>=<span class="string">"background:red;"</span>&gt;</span></div><div class="line">​     <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>​    js中代码如下:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">  $scope.outsideDivAction = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">​     <span class="built_in">console</span>.log(<span class="string">"外面div方法执行"</span>);</div><div class="line">&#125;;</div><div class="line">  $scope.insideDivAction = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">​      <span class="built_in">console</span>.log(<span class="string">"里面div方法执行"</span>);</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>​    执行上方代码发现, 点击里面的div, 外面的方法也会执行; 往往在实际工程中, 需要屏蔽外面的方法, 解决代码如下:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"> $scope.insideDivAction = <span class="function"><span class="keyword">function</span>(<span class="params">$event</span>)</span>&#123;</div><div class="line">​       $event.stopPropagation();</div><div class="line">​       <span class="built_in">console</span>.log(<span class="string">"里面div方法执行"</span>);</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>​    本以为这样就可以了, 但是后来才发现$event其实也算一个参数, 所以得在html中传递一下;<br>​    html中添加参数如下:<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">click</span>=<span class="string">"insideDivAction($event)"</span> <span class="attr">style</span>=<span class="string">"background:red;"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>参考链接:<br><a href="http://www.w3school.com.cn/jsref/event_stoppropagation.asp" target="_blank" rel="external">stopPropagation() 方法</a><br>希望这篇文章能帮到大家, 谢谢;</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;https://ooo.0o0.ooo/2017/06/22/594b8239c64d5.jpeg&quot; alt=&quot;&quot;&gt;&lt;br&gt;​    嵌套的div元素，如果父级和子元素都绑定了一些事件，那么在点击最内层子元素时可能会触发父级元素的事件，下面介绍一下js阻止默认事件与js阻止事件冒泡示例.&lt;/p&gt;
&lt;h4 id=&quot;一-event-preventDefault&quot;&gt;&lt;a href=&quot;#一-event-preventDefault&quot; class=&quot;headerlink&quot; title=&quot;一.event.preventDefault()&quot;&gt;&lt;/a&gt;一.event.preventDefault()&lt;/h4&gt;&lt;p&gt;​    阻止元素的默认事件。如:a元素的点击跳转的默认事件 ，button，radio等表单元素的默认事件 ，div 元素没有默认事件;&lt;br&gt;例:&lt;br&gt;   下方为html代码:&lt;br&gt;&lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;link&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;https://www.baidu.com&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;百度&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;a&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="js" scheme="https://binzi56.github.io/categories/js/"/>
    
    
      <category term="javascript" scheme="https://binzi56.github.io/tags/javascript/"/>
    
  </entry>
  
</feed>
